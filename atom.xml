<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Stephen&#39;blog</title>
  <subtitle>Just do It</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-12-08T07:16:26.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Stephen Liu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>react-router 源码分析</title>
    <link href="http://yoursite.com/2016/11/28/react-router/"/>
    <id>http://yoursite.com/2016/11/28/react-router/</id>
    <published>2016-11-27T17:29:42.000Z</published>
    <updated>2016-12-08T07:16:26.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="source-code" scheme="http://yoursite.com/tags/source-code/"/>
    
  </entry>
  
  <entry>
    <title>最小编辑距离问题（Edit Distance）</title>
    <link href="http://yoursite.com/2016/11/23/Min-Edit-Distance/"/>
    <id>http://yoursite.com/2016/11/23/Min-Edit-Distance/</id>
    <published>2016-11-23T07:39:01.000Z</published>
    <updated>2016-12-08T07:16:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在研究<code>react-diff</code>算法的时候，遇到了两个Virtual DOM列表的Diff，其实就是典型的最小编辑距离(Edit Distance)问题，于是抱着强烈的好奇心去研究了一番并做个总结。  </p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>什么是编辑距离？简单来说就是两个字符串之间，一个转成另一个的最少编辑操作次数，也就是说编辑距离是衡量两个字符串相似性的度量方法，距离越小相似度越大，而其中允许编辑的操作有：插入（insert），删除（delete）以及替换（substitution）。</p>
<p>这里可以看具体问题的描述（摘自<a href="https://leetcode.com/problems/edit-distance/" target="_blank" rel="external">leetcode</a>）：  </p>
<blockquote>
<p>Given two words word1 and word2, find the minimum number of steps required to convert word1 to word2. (each operation is counted as 1 step.)</p>
<p>You have the following 3 operations permitted on a word:</p>
<p>a) Insert a character<br>b) Delete a character<br>c) Replace a character  </p>
</blockquote>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>具体思路如下图：  </p>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/editdistance.png" alt=""></p>
<p>假设字符串<code>X</code>的长度为N,字符串<code>Y</code>的长度为M，<code>D(i,j)</code>表示字符串<code>X[1...i]</code>转换为<code>Y[1...j]</code>的编辑距离：</p>
<blockquote>
<p>注意： 其中<code>X[i]</code>和<code>Y[j]</code>表示字符串<code>X</code>和<code>Y</code>的最后一位    </p>
</blockquote>
<p><strong>初始化:</strong>  </p>
<p>D(i,0) = i，表示Y字符串为空，X[1…i]全部删除，所以编辑距离为i<br>D(0,j) = j，表示X字符串为空，新插入Y[1…j]，所以编辑距离为j    </p>
<p><strong>递归关系:</strong> </p>
<blockquote>
<p>例子中 &gt;&gt; 定义为字符串转换</p>
</blockquote>
<ul>
<li>当<code>X[i]</code>与<code>Y[j]</code>相等时，此时<code>D(i,j) = D(i-1,j-1)</code>，比如 <code>xyz &gt;&gt; thz</code> 与 <code>xy &gt;&gt; th</code> 的编辑距离相等。</li>
<li>当<code>X[i]</code>与<code>Y[j]</code>不相等时，取下面三项的最小值：  <ul>
<li><code>D(i-1,j) + 1</code>，即删除<code>X[i]</code>，编辑距离+1，比如<code>xyz &gt;&gt; thx = xy &gt;&gt; thx + 1</code></li>
<li><code>D(i,j-1) + 1</code>，即插入<code>Y[j]</code>，转换后编辑距离+1，比如 <code>xyz &gt;&gt; thx = xyzx &gt;&gt; thx + 1 = xyz &gt;&gt; th + 1</code></li>
<li><code>D(i-1,j-1) + 2</code>，即<code>X[i]</code>替换成<code>Y[j]</code>，比如<code>xyz &gt;&gt; thx = xyx &gt;&gt; thx + 2 = xy &gt;&gt; th + 2</code> </li>
</ul>
</li>
</ul>
<p>最后求的这三项的最小值就是编辑距离。</p>
<h3 id="递归算法"><a href="#递归算法" class="headerlink" title="递归算法"></a>递归算法</h3><p>我们按照上面的思路用代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> editDistance = (</div><div class="line">  word1,</div><div class="line">  word2,</div><div class="line">  i,</div><div class="line">  j </div><div class="line">) =&gt; &#123;</div><div class="line">  <span class="keyword">const</span> len1 = word1.length</div><div class="line">  <span class="keyword">const</span> len2 = word2.length</div><div class="line">  <span class="keyword">const</span> d = []</div><div class="line">  <span class="keyword">if</span>(len1 === <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">return</span> len2</div><div class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(len2 === <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">return</span> len1</div><div class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(word1[i<span class="number">-1</span>] === word2[j<span class="number">-1</span>])&#123;</div><div class="line">    <span class="keyword">return</span> editDistance(word1,word2,i<span class="number">-1</span>,j<span class="number">-1</span>)</div><div class="line">  &#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.min(editDistance(word1,word2,i<span class="number">-1</span>,j) + <span class="number">1</span>,</div><div class="line">      		    editDistance(word1,word2,i,j<span class="number">-1</span>) + <span class="number">1</span>,</div><div class="line">      		    editDistance(word1,word2,i<span class="number">-1</span>,j<span class="number">-1</span>) + <span class="number">2</span></div><div class="line">      		    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>显然这样写的代码，性能是一个很大的问题，时间复杂度是随指数增长的，所以解决该问题的办法是使用动态规划求解。  </p>
<h3 id="动态规划算法"><a href="#动态规划算法" class="headerlink" title="动态规划算法"></a>动态规划算法</h3><p>我们可以用动态规划的方法来优化时间复杂度<br>以<code>word1</code>为<code>‘sot’</code>，<code>word2</code>为<code>‘stop’</code>为例，我们首先创建一个矩阵：</p>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/editdistance1.png" alt=""></p>
<p>计算 <code>i=1,j=1</code>:   </p>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/editdistance3.png" alt=""></p>
<p>得到:  </p>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/editdistance2.png" alt=""></p>
<p>计算<code>i=1,j=2</code>:  </p>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/editdistance5.png" alt=""></p>
<p>得到：  </p>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/editdistance4.png" alt=""></p>
<p>最终可以的得到：  </p>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/editdistance6.png" alt=""></p>
<p>于是可以得到最短编辑距离为<code>d[m][n] = 3</code>，现在时间复杂度控制在了O(mn)。</p>
<p>具体算法如下：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> editDistance = (</div><div class="line">  word1,</div><div class="line">  word2</div><div class="line">) =&gt; &#123;</div><div class="line">  <span class="keyword">const</span> len1 = word1.length</div><div class="line">  <span class="keyword">const</span> len2 = word2.length</div><div class="line">  <span class="keyword">let</span> d = []</div><div class="line">  <span class="keyword">let</span> i,j</div><div class="line">  </div><div class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt;= len1; i++)&#123;</div><div class="line">    d[i] = []	</div><div class="line">    d[i][<span class="number">0</span>] = i  </div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt;= len2; j++)&#123;</div><div class="line">    d[<span class="number">0</span>][j] = j</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">for</span>(i = <span class="number">1</span>; i&lt;= len1; i++)&#123;</div><div class="line">    <span class="keyword">for</span>(j = <span class="number">1</span>; j &lt;= len2; j++)&#123;</div><div class="line">      <span class="keyword">if</span>(word1[i<span class="number">-1</span>] == word2[j<span class="number">-1</span>])&#123;</div><div class="line">        d[i][j] = d[i<span class="number">-1</span>][j<span class="number">-1</span>]</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        d[i][j] = <span class="built_in">Math</span>.min(d[i<span class="number">-1</span>][j]+<span class="number">1</span>,d[i][j<span class="number">-1</span>]+<span class="number">1</span>,d[i<span class="number">-1</span>][j<span class="number">-1</span>]+<span class="number">2</span>)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> d[len1][len2]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>具体还可以进行空间复杂度的优化，这里我没有做等以后再研究。  </p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://web.stanford.edu/class/cs124/lec/med.pdf" target="_blank" rel="external">stanford - Minimum&amp;Edit&amp;Distance</a>  </li>
<li><a href="http://ccl.pku.edu.cn/doubtfire/Course/Computational%20Linguistics/contents/Minimum%20Edit%20Distance.pdf" target="_blank" rel="external">最小编辑距离算法</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近在研究&lt;code&gt;react-diff&lt;/code&gt;算法的时候，遇到了两个Virtual DOM列表的Diff，其实就是典型的最小编辑距
    
    </summary>
    
    
      <category term="algorithm" scheme="http://yoursite.com/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>实现一个VirtualDOM的轮子</title>
    <link href="http://yoursite.com/2016/11/14/Virtual-Dom/"/>
    <id>http://yoursite.com/2016/11/14/Virtual-Dom/</id>
    <published>2016-11-13T17:24:11.000Z</published>
    <updated>2016-12-08T07:14:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>学习React有一段时间了，一直想深入了解一下React的核心技术之一VirtualDOM的实现原理，于是便研究了一下其中的算法实现，实现了一个简易版本的VirtualDOM来帮助自己理解。  </p>
<h2 id="什么是VirtualDOM"><a href="#什么是VirtualDOM" class="headerlink" title="什么是VirtualDOM"></a>什么是VirtualDOM</h2><h3 id="状态管理与UI同步的今世前生"><a href="#状态管理与UI同步的今世前生" class="headerlink" title="状态管理与UI同步的今世前生"></a>状态管理与UI同步的今世前生</h3><p>在Web早期，页面通常是静态的，也就是说页面上的状态一旦发生改变，需要重新请求页面，得到基于新数据的新页面。随着web应用越来越复杂，开发者发现很多情况下都只是部分状态发生改变，所以并不需要重新渲染整个页面，只要更改新状态对应的UI就好了。<br>不过如何实现呢？最简单的办法就是操作DOM了，不过由于DOM的复杂性，开发者不得不编写大量代码，为了简化这个过程，许多框架就像雨后春笋般出现了。</p>
<h3 id="Data-Binding"><a href="#Data-Binding" class="headerlink" title="Data Binding"></a>Data Binding</h3><p>这类框架开发者只需要将UI绑定到状态(model)上，监听数据的变更，一旦变更就更新对应的UI节点：<br><img src="http://upload-images.jianshu.io/upload_images/37341-085d63a591c8647d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p>以<code>Angular</code>为例的MVVM框架采用脏检查的方式来找到需要重新渲染的UI节点，虽然这种方式依然使用数据变化后更新对应 DOM 节点的方式，不过建立这种绑定关系交给了框架去处理。  </p>
<p><img src="http://upload-images.jianshu.io/upload_images/37341-45f13340118dcea9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="VirtualDOM"><a href="#VirtualDOM" class="headerlink" title="VirtualDOM"></a>VirtualDOM</h3><p>React的VirtualDOM的思路更为直接，初次渲染时，将数据渲染为VirtualDOM，然后通过这个VirtualDOM（javascript<br>对象）去生成真实的DOM，当状态变化时，得到一个新的VirtualDOM，将新的与旧的进行diff得到差异，然后在patch过程中将差异反映到真实DOM上，从而将操作DOM控制在最小。  </p>
<p><img src="http://upload-images.jianshu.io/upload_images/37341-f3172ab2917534d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">  </p>
<h2 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>VirtualDOM算法主要有三个步骤:  </p>
<ul>
<li>用 js 对象模拟DOM Tree</li>
<li>diff两个虚拟的DOM Tree</li>
<li>把差异反映到真实的DOM Tree</li>
</ul>
<h3 id="一、用-js-对象模拟DOM-Tree"><a href="#一、用-js-对象模拟DOM-Tree" class="headerlink" title="一、用 js 对象模拟DOM Tree"></a>一、用 js 对象模拟DOM Tree</h3><h3 id="二、diff两个虚拟的DOM-Tree"><a href="#二、diff两个虚拟的DOM-Tree" class="headerlink" title="二、diff两个虚拟的DOM Tree"></a>二、diff两个虚拟的DOM Tree</h3><h3 id="三、把差异反映到真实的DOM-Tree"><a href="#三、把差异反映到真实的DOM-Tree" class="headerlink" title="三、把差异反映到真实的DOM Tree"></a>三、把差异反映到真实的DOM Tree</h3><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://teropa.info/blog/2015/03/02/change-and-its-detection-in-javascript-frameworks.html" target="_blank" rel="external">Change And Its Detection In JavaScript Frameworks</a></li>
<li><a href="http://www.infoq.com/cn/articles/react-dom-diff" target="_blank" rel="external">深入浅出React（四）：虚拟DOM Diff算法解析</a>  </li>
<li><a href="https://github.com/livoras/blog/issues/13" target="_blank" rel="external">深度剖析：如何实现一个 Virtual DOM 算法</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/20346379?refer=purerender" target="_blank" rel="external">React 源码剖析系列 － 不可思议的 react diff</a></li>
<li><a href="https://segmentfault.com/a/1190000003741294" target="_blank" rel="external">Edit Distance 最小编辑距离</a></li>
<li><a href="http://grfia.dlsi.ua.es/ml/algorithms/references/editsurvey_bille.pdf" target="_blank" rel="external">A Survey on Tree Edit Distance and Related<br>Problems</a></li>
<li><a href="https://medium.com/@deathmood/how-to-write-your-own-virtual-dom-ee74acc13060#.1ripyt7yi" target="_blank" rel="external">How to write your own Virtual DOM(1)</a></li>
<li><a href="https://medium.com/@deathmood/write-your-virtual-dom-2-props-events-a957608f5c76#.fjuyeqczn" target="_blank" rel="external">How to write your own Virtual DOM(2)</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;学习React有一段时间了，一直想深入了解一下React的核心技术之一VirtualDOM的实现原理，于是便研究了一下其中的算法实现，实现了
    
    </summary>
    
    
      <category term="react" scheme="http://yoursite.com/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>基于Phaser写一个简单的FlappyBird</title>
    <link href="http://yoursite.com/2016/11/04/flappyBird-with-phaser/"/>
    <id>http://yoursite.com/2016/11/04/flappyBird-with-phaser/</id>
    <published>2016-11-04T12:56:27.000Z</published>
    <updated>2016-11-05T11:00:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a href="http://phaser.io" target="_blank" rel="external">Phaser</a>是一个免费开源而且功能强大的html5游戏框架，利用它可以很轻松的开发出一个html5游戏。本篇文章主要讲利用Phaser来开发一个简单的flappy bird。这里有试玩地址<a href="https://stephenlyao.github.io/HTML5-Games/FlappyBird/" target="_blank" rel="external">Play</a>，相关代码放在了<a href="https://github.com/stephenLYao/HTML5-Games" target="_blank" rel="external">github</a>上。  </p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在开始前，为了让我们更专注于写游戏代码上，可以先下载一份<a href="http://7xl0rs.com1.z0.glb.clouddn.com/FlappyBird.zip" target="_blank" rel="external">模版</a>，下载后里面的目录结构为： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-- FlappyBird</div><div class="line">   -- assets</div><div class="line">      -- bird.png</div><div class="line">      -- pipe.png</div><div class="line">      -- hurt.wav</div><div class="line">      -- score.wav</div><div class="line">      -- jump.wav</div><div class="line">   -- main.js</div><div class="line">   -- phaser.min.js</div><div class="line">   -- index.html</div></pre></td></tr></table></figure>
<p>其中<code>assets</code>主要放置我们的精灵图以及声音素材，<code>main.js</code>主要是写游戏逻辑的地方。前期工作准备好了后，接下来我们就开始吧！  </p>
<h2 id="新建游戏"><a href="#新建游戏" class="headerlink" title="新建游戏"></a>新建游戏</h2><p>首先在<code>main.js</code>中新建一个空的Phaser游戏：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建一个mainState来包裹整个游戏状态</span></div><div class="line"><span class="keyword">var</span> mainState = &#123;</div><div class="line">    preload: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">  		<span class="comment">// preload函数会在游戏开始前执行</span></div><div class="line">  		<span class="comment">// 所以这里主要放置图片声音等资源来进行预加载</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    create: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">        <span class="comment">// create函数在preload函数后加载     </span></div><div class="line">        <span class="comment">// 所以这里主要设置游戏，显示精灵图等 </span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    update: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// update函数每秒会调用60次    </span></div><div class="line">        <span class="comment">// 所以这里主要放置游戏逻辑   </span></div><div class="line">    &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 初始化Phaser，创建宽400px，高490px的游戏</span></div><div class="line"><span class="keyword">var</span> game = <span class="keyword">new</span> Phaser.Game(<span class="number">400</span>, <span class="number">490</span>);</div><div class="line"></div><div class="line"><span class="comment">// 加入mainState, 命名为'main'</span></div><div class="line">game.state.add(<span class="string">'main'</span>, mainState); </div><div class="line"></div><div class="line"><span class="comment">// 执行游戏开始</span></div><div class="line">game.state.start(<span class="string">'main'</span>);</div></pre></td></tr></table></figure>
<p>接下来我们就开始写<code>preload()</code>、<code>create()</code>以及<code>update()</code>函数。</p>
<h2 id="创建Bird"><a href="#创建Bird" class="headerlink" title="创建Bird"></a>创建Bird</h2><p>下面我们来创建游戏中的bird：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">preload: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    </div><div class="line">    <span class="comment">// 加载bird精灵图</span></div><div class="line">    game.load.image(<span class="string">'bird'</span>, <span class="string">'assets/bird.png'</span>); </div><div class="line">&#125;,</div><div class="line"></div><div class="line">create: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    <span class="comment">// 游戏背景颜色</span></div><div class="line">    game.stage.backgroundColor = <span class="string">'#71c5cf'</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 设置游戏物理系统</span></div><div class="line">    game.physics.startSystem(Phaser.Physics.ARCADE);</div><div class="line"></div><div class="line">    <span class="comment">// 设置bird出现的位置，这里我设置的坐标为(100,245)</span></div><div class="line">    <span class="keyword">this</span>.bird = game.add.sprite(<span class="number">100</span>, <span class="number">245</span>, <span class="string">'bird'</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 给bird加上物理系统，让它具有移动、重力、碰撞等等</span></div><div class="line">    game.physics.arcade.enable(<span class="keyword">this</span>.bird);</div><div class="line"></div><div class="line">    <span class="comment">// 添加重力，让bird能够向下掉</span></div><div class="line">    <span class="keyword">this</span>.bird.body.gravity.y = <span class="number">1000</span>;  </div><div class="line"></div><div class="line">    <span class="comment">// 当按下空格后，调用jump()函数（后面会提到这个函数）</span></div><div class="line">    <span class="keyword">var</span> spaceKey = game.input.keyboard.addKey(</div><div class="line">                    Phaser.Keyboard.SPACEBAR);</div><div class="line">    spaceKey.onDown.add(<span class="keyword">this</span>.jump, <span class="keyword">this</span>);     </div><div class="line">&#125;,</div><div class="line"></div><div class="line">update: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 判断bird如果超出屏幕边界，则调用restartGame()函数</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.bird.y &lt; <span class="number">0</span> || <span class="keyword">this</span>.bird.y &gt; <span class="number">490</span>)</div><div class="line">        <span class="keyword">this</span>.restartGame();</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>下面我们添加两个函数，一个是<code>jump()</code>一个<code>restartGame()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">jump: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="comment">// 减少bird竖直方向的速度</span></div><div class="line">	<span class="keyword">this</span>.bird.body.velocity.y = <span class="number">-350</span></div><div class="line">&#125;,</div><div class="line"></div><div class="line">restartGame: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="comment">// 重启游戏</span></div><div class="line">	game.state.start(<span class="string">'main'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><blockquote>
<p>注意如果你直接在浏览器打开index.html文件，会报<code>Uncaught SecurityError: Failed to execute &#39;texImage2D&#39; on &#39;WebGLRenderingContext&#39;</code>的错误，这是因为javascript不允许在本地文件系统下加载文件，为了解决这个问题可以使用一个webserver，比如</p>
<ul>
<li>使用<code>python -m SimpleHTTPServer</code> 然后访问<code>localhost:8000</code>;</li>
<li>下载<a href="https://www.npmjs.com/package/http-server" target="_blank" rel="external">http-server</a>，使用<code>http-server</code>访问<code>localhost:8080</code>  </li>
</ul>
</blockquote>
<p>最终你可以看到这个：  </p>
<p><img src="http://www.lessmilk.com/imgtut/FB1/3.gif" alt=""></p>
<h2 id="创建Pipes"><a href="#创建Pipes" class="headerlink" title="创建Pipes"></a>创建Pipes</h2><p>现在我们来添加管道障碍物。首先，我们先在<code>preload()函数</code>里加载pipe资源:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">game.load.image(<span class="string">'pipe'</span>,<span class="string">'assets/pipe.png'</span>)</div></pre></td></tr></table></figure>
<p>因为游戏里会有许多的pipes，所以我们可以使用Phaser里的<code>group()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.pipes = game.add.group()</div></pre></td></tr></table></figure>
<p>接下来设置单独的一个pipe：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 传进pipe的坐标作为参数</span></div><div class="line">addOnePipe: <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</div><div class="line">	<span class="comment">//创建一个pipe(x,y)	</span></div><div class="line">	<span class="keyword">var</span> pipe = game.add.sprite(<span class="string">'pipe'</span>,x,y)</div><div class="line">	</div><div class="line">	<span class="comment">//将pipe加入到group中去</span></div><div class="line">	<span class="keyword">this</span>.pipes.add(pipe)</div><div class="line">	</div><div class="line">	<span class="comment">//加入物理效果</span></div><div class="line">	game.physics.arcade.enable(pipe)</div><div class="line">	</div><div class="line">	<span class="comment">//给pipe添加向左移动的速度（向左为负，向右为正，这里我们主要是让pipe向左移动）</span></div><div class="line">	pipe.body.velocity.x = <span class="number">-200</span></div><div class="line">	</div><div class="line">	<span class="comment">// 当pipe不在视野的时候，自动的销毁	</span></div><div class="line">	pipe.checkWorldBounds = <span class="literal">true</span></div><div class="line">	pipe.outOfBoundsKill = <span class="literal">true</span></div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们来创建一排的pipes，主要有6个pipe，2个hole，其中hole的位置是随机且两个hole是相邻的: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addRowOfPipes: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="comment">//随机产生hole</span></div><div class="line">	<span class="keyword">var</span> hole = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">5</span>) + <span class="number">1</span></div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</div><div class="line">		<span class="keyword">if</span>(i != hole &amp;&amp; i != hole + <span class="number">1</span>)&#123;</div><div class="line">			<span class="keyword">this</span>.addOnePipe(<span class="number">400</span>,i * <span class="number">60</span> + <span class="number">10</span>)</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面图就非常清楚了：<br><img src="http://www.lessmilk.com/imgtut/FB1/6.png" alt=""></p>
<p>最后我们在<code>create()</code>函数里，通过每1.5秒循环调用<code>addRowOfPipes()</code>函数来创建一个<code>timer</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.timer = game.time.events.loop(<span class="number">1500</span>,<span class="keyword">this</span>.addRowOfPipes,<span class="keyword">this</span>)</div></pre></td></tr></table></figure>
<p>完成这一步后，效果应该是这样：  </p>
<p><img src="http://www.lessmilk.com/imgtut/FB1/4.gif" alt=""></p>
<h2 id="创建分数和碰撞"><a href="#创建分数和碰撞" class="headerlink" title="创建分数和碰撞"></a>创建分数和碰撞</h2><p>我们需要一个记分板来显示分数，于是在<code>create()</code>函数中添加:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.score = <span class="number">0</span></div><div class="line"><span class="keyword">this</span>.scoreLabel = game.add.text(<span class="number">20</span>,<span class="number">20</span>,<span class="string">'0'</span>,&#123;fill: <span class="string">'#fff'</span>&#125;)</div></pre></td></tr></table></figure>
<p>然后分数增加的形式我们设置为，每次创建一排的pipes就加一分，也就是在<code>addRowOfPipes</code>中加上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.score += <span class="number">1</span></div><div class="line"><span class="keyword">this</span>.scoreLabel.text = <span class="keyword">this</span>.score</div></pre></td></tr></table></figure>
<p>下面我们加入碰撞，每次碰撞后调用<code>restartGame()</code>函数:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">game.physics.arcade.overlap(<span class="keyword">this</span>.bird, <span class="keyword">this</span>.pipes, <span class="keyword">this</span>.restartGame, <span class="literal">null</span>, <span class="keyword">this</span>)</div></pre></td></tr></table></figure>
<p>效果如下：  </p>
<p><img src="http://www.lessmilk.com/imgtut/FB1/5.gif" alt=""></p>
<h2 id="添加jump动画"><a href="#添加jump动画" class="headerlink" title="添加jump动画"></a>添加jump动画</h2><p>我们知道在flappybird中，bird会随下落而缓慢向下，随着jump而有向上的趋势，类似于这种效果:  </p>
<p><img src="http://www.lessmilk.com/imgtut/FB2/5.gif" alt=""></p>
<p>首先我们先实现随着下落而缓慢向下，在<code>update()</code>函数中添加:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.bird.angle &lt; <span class="number">20</span>)&#123;</div><div class="line">	<span class="keyword">this</span>.bird.angle += <span class="number">1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>原理也很简单，就是当bird的角度小于20的时候不断加一个度数（注意是顺时针方向）。<br>然后实现第二个效果，我们只要简单的设置<code>this.bird.angle = -20</code>就可以，不过为了让动画看起来更自然，我们可以让变化限制在非常短的时间内（比如100毫秒）: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 新建一个animation</span></div><div class="line"><span class="keyword">var</span> animation = game.add.tween(<span class="keyword">this</span>.bird)</div><div class="line"></div><div class="line"><span class="comment">// 改变角度并限制在100毫秒内</span></div><div class="line">animation.to(&#123;angle: <span class="number">-20</span>&#125;, <span class="number">100</span>)</div><div class="line"></div><div class="line"><span class="comment">// 执行动画</span></div><div class="line">animation.start()</div></pre></td></tr></table></figure>
<p>这里需要注意的一点是，此时bird旋转的效果并不是我们想要的效果，因为此时旋转的中心(我们称为’anchor’)在左上角，如下图左边的bird：  </p>
<p><img src="http://www.lessmilk.com/imgtut/FB2/2.png" alt=""></p>
<p>我们希望将anchor(上图红色的点)放置在右边bird的位置，于是我们在<code>create()</code>函数中设置: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.bird.anchor.setTo(<span class="number">-0.2</span>,<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<p>效果如下:  </p>
<p><img src="http://www.lessmilk.com/imgtut/FB2/3.gif" alt="">  </p>
<h2 id="添加死亡动画"><a href="#添加死亡动画" class="headerlink" title="添加死亡动画"></a>添加死亡动画</h2><p>之前当bird碰撞pipes后是直接重启游戏的，现在我们希望添加bird死亡掉落的动画,我们将之前<code>update()</code>函数里的<code>restartGame()</code>修改为<code>hitPipe()</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">game.physics.arcade.overlap(<span class="keyword">this</span>.bird,<span class="keyword">this</span>.pipes,<span class="keyword">this</span>.hitPipe,<span class="literal">null</span>,<span class="keyword">this</span>)</div></pre></td></tr></table></figure>
<p>hitPipe()函数如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">hitPipe: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="comment">// 如果bird已经碰撞了pipe，则不做任何事，此时表明bird已经掉落</span></div><div class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>.bird.alive == <span class="literal">false</span>)&#123;</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">this</span>.bird.alive == <span class="literal">false</span></div><div class="line">	</div><div class="line">	<span class="comment">// 将timer移除，防止出现新的pipes</span></div><div class="line">	game.time.events.remove(<span class="keyword">this</span>.timer)</div><div class="line">	</div><div class="line">	<span class="comment">// 让所有的pipes停止运动</span></div><div class="line">	<span class="keyword">this</span>.pipes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">p</span>)</span>&#123;</div><div class="line">        p.body.velocity.x = <span class="number">0</span>;</div><div class="line">    &#125;, <span class="keyword">this</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接着为了不让bird在碰撞pipe后继续jump，我们添加以下代码:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.bird.alive == <span class="literal">false</span>)&#123;</div><div class="line">    <span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下：  </p>
<p><img src="http://www.lessmilk.com/imgtut/FB2/4.gif" alt=""></p>
<h2 id="添加声音"><a href="#添加声音" class="headerlink" title="添加声音"></a>添加声音</h2><p>首先我们先在<code>preload()</code>函数加载声音资源:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">game.load.audio(<span class="string">'jump'</span>,<span class="string">'assets/jump.wav'</span>)</div><div class="line">game.load.audio(<span class="string">'dead'</span>,<span class="string">'assets/hurt.wav'</span>)</div><div class="line">game.load.audio(<span class="string">'score'</span>,<span class="string">'assets/score.wav'</span>)</div></pre></td></tr></table></figure>
<p>分别是jump的声音、死亡的声音以及得分的声音。  </p>
<p>然后我们在<code>create()</code>中设置这三种： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.jumpSong = game.add.audio(<span class="string">'jump'</span>)</div><div class="line"><span class="keyword">this</span>.deadSong = game.add.audio(<span class="string">'dead'</span>)</div><div class="line"><span class="keyword">this</span>.scoreSong = game.add.audio(<span class="string">'score'</span>)</div></pre></td></tr></table></figure>
<p>我们在<code>jump()</code>函数中添加：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.jumpSong.play()</div></pre></td></tr></table></figure>
<p>在<code>hitPipe()</code>函数中添加：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.deadSong.play()</div></pre></td></tr></table></figure>
<p>在<code>addRowOfPipes()</code>函数中添加：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.scoreSong.play()</div></pre></td></tr></table></figure>
<p>接下来就可以开始愉快的玩耍了:)</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="http://phaser.io" target="_blank" rel="external">Phaser.io</a><br><a href="http://www.lessmilk.com/tutorial/flappy-bird-phaser-1" target="_blank" rel="external">flappy-bird-phaser</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://phaser.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Phaser&lt;/a&gt;是一
    
    </summary>
    
    
      <category term="html5" scheme="http://yoursite.com/tags/html5/"/>
    
  </entry>
  
  <entry>
    <title>探索javascript异步编程</title>
    <link href="http://yoursite.com/2016/10/21/javascript-asynchronous-programming/"/>
    <id>http://yoursite.com/2016/10/21/javascript-asynchronous-programming/</id>
    <published>2016-10-21T08:59:11.000Z</published>
    <updated>2016-12-08T07:17:59.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>jquery以及underscore中的无new构造</title>
    <link href="http://yoursite.com/2016/10/05/jquery-no-new/"/>
    <id>http://yoursite.com/2016/10/05/jquery-no-new/</id>
    <published>2016-10-05T06:25:09.000Z</published>
    <updated>2016-12-08T07:15:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>首先我们来看看jquery中的无new构造，我们知道，jquery中可以通过以下两种方式来构造对象：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 无new</span></div><div class="line">$(<span class="string">'#id'</span>).context(<span class="string">'hello world'</span>) </div><div class="line"></div><div class="line"><span class="comment">// 有new</span></div><div class="line"><span class="keyword">var</span> id = <span class="keyword">new</span> $(<span class="string">'#id'</span>)</div><div class="line">id.context(<span class="string">'hello world'</span>)</div></pre></td></tr></table></figure>
<p>显然，我们用得最多就是第一种无new的构造方式，那这种方式内部又是怎么实现的呢？下面我们一步步来实现这样的效果。<br>js中函数是一等公民，我们在用oop形式编程的时候，很容易的会使用类来实例化对象： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 构造函数</span></div><div class="line"><span class="keyword">var</span> cQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, contex</span>)</span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">cQuery.prototype = &#123;</div><div class="line">	setName: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name = name</div><div class="line">	&#125;,</div><div class="line">	name: <span class="string">'stephen'</span>,</div><div class="line">	age: <span class="number">20</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> cQuery()</div><div class="line"></div><div class="line">c.age  <span class="comment">// 20</span></div></pre></td></tr></table></figure>
<p>如果我们想通过无new来构造对象的话，我们第一反应可能是这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> cQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, contex</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> cQuery()</div><div class="line">&#125;</div><div class="line"></div><div class="line">cQuery.prototype = &#123;</div><div class="line">	setName: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name = name</div><div class="line">	&#125;,</div><div class="line">	name: <span class="string">'stephen'</span>,</div><div class="line">	age: <span class="number">20</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们会发现这样就陷入了一个无穷的循环之中，显然是不行的。我们其实可以把cQuery类当作一个工厂方法来创建实例，把这个方法放cQuery.prototye原型对象中:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> cQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, contex</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> cQuery.prototype.init()</div><div class="line">&#125;</div><div class="line"></div><div class="line">cQuery.prototype = &#123;</div><div class="line">	init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">	&#125;,</div><div class="line">	setName: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name = name</div><div class="line">	&#125;,</div><div class="line">	name: <span class="string">'stephen'</span>,</div><div class="line">	age: <span class="number">20</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>看起来似乎解决了我们的问题，但是如果我们想在init使用this呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> cQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, contex</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> cQuery.prototype.init()</div><div class="line">&#125;</div><div class="line"></div><div class="line">cQuery.prototype = &#123;</div><div class="line">	init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">this</span>.age = <span class="number">18</span></div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">	&#125;,</div><div class="line">	setName: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name = name</div><div class="line">	&#125;,</div><div class="line">	name: <span class="string">'stephen'</span>,</div><div class="line">	age: <span class="number">20</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">cQuery().age  <span class="comment">//18</span></div><div class="line">cQuery().name  <span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<p>显然，这时候由于是实例init()函数，所以this和原来cQuery的this作用域分离了，age会指向init中的age，而name由于init中未定义，所以为undefine。 这显然不是我们要的效果，那我们该解决呢？ 其实很简单： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cQuery.prototype.init.prototype = cQuery.prototype</div></pre></td></tr></table></figure>
<p>这便是最精妙的地方，将cQuery的prototype的属性赋给init的prototype，这样就保证了this虽然指向init，但仍然继承aQuery上的属性。<br>上面内容其实就是jquery中实现无new构造的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">　　jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">        <span class="comment">// The jQuery object is actually just the init constructor 'enhanced'</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init(selector, context, rootjQuery);</div><div class="line">    &#125;,</div><div class="line">    jQuery.fn = jQuery.prototype = &#123;</div><div class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context, rootjQuery</span>) </span>&#123;</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    jQuery.fn.init.prototype = jQuery.fn;</div><div class="line">&#125;)(<span class="built_in">window</span>);</div></pre></td></tr></table></figure>
<p>最后在谈谈underscore中的无new构造，放上源码注释： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> _ = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> _) <span class="keyword">return</span> obj;  </div><div class="line">        <span class="comment">// 如果Obj已经是underscore对象，则原样返回</span></div><div class="line">        <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> _)) <span class="keyword">return</span> <span class="keyword">new</span> _(obj); </div><div class="line">        <span class="comment">// 采用这种写法即使没用new操作符也可以构造新undersocre对象</span></div><div class="line">        <span class="keyword">this</span>._wrapped = obj; </div><div class="line">        <span class="comment">// underscore对象有实例属性_wrapped，保存着obj（用户传入的待处理的数据）</span></div><div class="line">      &#125;;</div><div class="line">      </div><div class="line">root._ = _</div></pre></td></tr></table></figure>
<p>其实也很简单，判断是否为underscore的对象，是就直接返回，不是就new一下（注意： 这里不会造成死循环的原因是因为第一个判断的存在 。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;首先我们来看看jquery中的无new构造，我们知道，jquery中可以通过以下两种方式来构造对象：  &lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div cla
    
    </summary>
    
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>Array-Like Object in Javascript</title>
    <link href="http://yoursite.com/2016/09/25/array-like-to-array/"/>
    <id>http://yoursite.com/2016/09/25/array-like-to-array/</id>
    <published>2016-09-25T09:00:31.000Z</published>
    <updated>2016-12-08T07:15:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-is-Array-Like-Object"><a href="#What-is-Array-Like-Object" class="headerlink" title="What is Array-Like Object?"></a>What is Array-Like Object?</h2><p>As we all know,everything in javascript is <strong>Object</strong>.So an array-like object is not a separate object type,it’s an object we are familiar with.Why? Maybe you often use <code>arguments</code> variable in javascript function by default.Like this:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="built_in">arguments</span>[<span class="number">0</span>])</div><div class="line">	<span class="built_in">console</span>.log(<span class="built_in">arguments</span>[<span class="number">1</span>])</div><div class="line">	<span class="built_in">console</span>.log(<span class="built_in">arguments</span>.length)</div><div class="line">&#125;</div><div class="line">foo(<span class="string">'A'</span>,<span class="string">'B'</span>)  </div><div class="line"></div><div class="line"><span class="comment">// A</span></div><div class="line"><span class="comment">// B</span></div><div class="line"><span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>Okay,it has <code>length</code>  property right?So is it an array? No!If you push some stuff to it like this:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">arguments</span>.push(<span class="string">'C'</span>)</div><div class="line"><span class="comment">//// TypeError: Object has no method 'push'</span></div></pre></td></tr></table></figure>
<p>Then you will realize that none of the array methods, like pop(), shift(), forEach() etc work.In fact ,we call this “Array-Like”.<br>An Array-Like Object has two features:  </p>
<ul>
<li>has indexed access to elements and the property <code>length</code></li>
<li>doesn’t have array methods ,like push(),pop() etc.</li>
</ul>
<h2 id="Common-Array-Like-Objects"><a href="#Common-Array-Like-Objects" class="headerlink" title="Common Array-Like Objects"></a>Common Array-Like Objects</h2><ul>
<li>document.getElementsByClassName()</li>
<li>document.getElementsByTagName()</li>
<li>document.getElementsByName()</li>
<li>document.stylesheets</li>
<li>parentNode.chidlNodes</li>
<li>arguments</li>
<li>document.querySelectorAll()</li>
</ul>
<h2 id="Converting-an-Array-Like-Object-to-an-array"><a href="#Converting-an-Array-Like-Object-to-an-array" class="headerlink" title="Converting an Array-Like Object to an array"></a>Converting an Array-Like Object to an array</h2><p>Sometimes it’s better to convert an array-like object  to an array.A very straight method is creating an array,like this:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span> (<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> array = []</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i &lt; <span class="built_in">arguments</span>.length;i++)&#123;</div><div class="line">		arr[i] = <span class="built_in">arguments</span>[i]</div><div class="line">	&#125;</div><div class="line">	array.push(<span class="number">5</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">fn(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) </div><div class="line"></div><div class="line"><span class="comment">// [1,2,3,4,5]</span></div></pre></td></tr></table></figure>
<p>However, it’s not elegant at all. We can use<br>:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>)</div></pre></td></tr></table></figure>
<p>Or use [ ] to replace <code>array.prototype</code>:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[].slice.call(<span class="built_in">arguments</span>)</div></pre></td></tr></table></figure>
<p>The reason that slice() can convert an array-like to array, since it returns a shallow copy of elements from the original array. About the specific detail can refer to <a href="https://github.com/v8/v8/blob/master/src/js/array.js#L621-L660" target="_blank" rel="external">V8 source</a> .  </p>
<p>ES2015 provides a more convenient method <code>Array.from()</code>:</p>
<pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>{
    <span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>)
}

fn(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)

<span class="comment">//[1,2,3,4]</span>
</code></pre>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://www.2ality.com/2013/05/quirk-array-like-objects.html" target="_blank" rel="external">JavaScript quirk 8: array-like objects</a><br><a href="http://www.hacksparrow.com/javascript-array-like-objects.html" target="_blank" rel="external">JavaScript Array-like Objects</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from" target="_blank" rel="external">MDN  Array.from()</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;What-is-Array-Like-Object&quot;&gt;&lt;a href=&quot;#What-is-Array-Like-Object&quot; class=&quot;headerlink&quot; title=&quot;What is Array-Like Object?&quot;&gt;&lt;/a&gt;What is Ar
    
    </summary>
    
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>2016 NingJS(JSConf CN 2016) 见闻</title>
    <link href="http://yoursite.com/2016/09/06/2016-NingJS-JSConf-CN-2016/"/>
    <id>http://yoursite.com/2016/09/06/2016-NingJS-JSConf-CN-2016/</id>
    <published>2016-09-06T03:44:36.000Z</published>
    <updated>2016-12-08T07:15:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>第一次参加JSconf，也是我第一次来南京这座城市，这座有着丰富的文化历史底蕴的城市。参加这次JSconf心情是十分激动的，见到来自各地的开发者，感受他们分享的经历与成长，这对我自身也有很大激励与启发。下面就是我对参加峰会的记录整理。</p>
<h2 id="9月3日"><a href="#9月3日" class="headerlink" title="9月3日"></a>9月3日</h2><h3 id="VUE-js"><a href="#VUE-js" class="headerlink" title="VUE.js"></a>VUE.js</h3><p>从出场的热烈掌声无不表明了尤小右在国内前端圈的受欢迎程度，作为首位分享的讲师，尤大大首先分享了progressive framework的概念，即  </p>
<pre><code>core －&gt; component system -&gt; routing -&gt;  large scale state management -&gt; build system -&gt; client-server data persistence  
</code></pre><p>其次回顾vue的历史，vue从最初诞生到发展成当今国内最热的框架，通过刚开始的想法然后动手去做，一步一步的积累最终达到了今天的成果。接着展望了vue2.0，vue2.0会更轻更快，并且支持virtual dom, 自动帮你做React 中的 shouldComponentUpdate。最后”weex powered by vue”也说明了vue和weex的合作。  </p>
<h3 id="HOW-TO-BUILD-A-COMPILER"><a href="#HOW-TO-BUILD-A-COMPILER" class="headerlink" title="HOW TO BUILD A COMPILER"></a>HOW TO BUILD A COMPILER</h3><p>虽然之前看过James Kyle在其他JSconf的分享视频，不过这一次亲眼见到大神还是比较激动的。首先James介绍了什么是compiler，以及一个compiler做了哪些事(parsing、transformation、code generation)，最后通过一行行代码解释了如何实现一个世界上最简单的编译器 – 实现了lisp风格的加减法到C风格的转换，不过还有很多地方不是很清楚，比如生成AST，具体我还需要下功夫去研究。其中最让人印象深刻的就是James的ppt风格了，虽然之前有过准备，不过现场看的确是 la eye(逃…<br>github仓库:<br><a href="https://github.com/thejameskyle/how-to-build-a-compiler" target="_blank" rel="external">how-to-build-a-compiler</a></p>
<h3 id="阿里node-团队开源项目，企业级框架EGG"><a href="#阿里node-团队开源项目，企业级框架EGG" class="headerlink" title="阿里node 团队开源项目，企业级框架EGG"></a>阿里node 团队开源项目，企业级框架EGG</h3><p>天猪介绍的node框架egg，基于KOA，并且提供了日志、路由、配置以及内置了web安全解决方案，还有一整套测试、集成、发布构建方案，不得不感慨企业级框架就是牛逼。<br>github仓库：<br><a href="https://github.com/eggjs/egg" target="_blank" rel="external">https://github.com/eggjs/egg</a>  </p>
<h3 id="聊聊-JS-测试框架"><a href="#聊聊-JS-测试框架" class="headerlink" title="聊聊 JS 测试框架"></a>聊聊 JS 测试框架</h3><p>主要讲了主流的测试框架，分别基于tapa流（tap、tape、ava）以及mocha流（jasmine 、mocha、jest）。最后介绍了自己基于mocha造的轮子tman。<br>github仓库：<br><a href="https://github.com/thunks/tman" target="_blank" rel="external">https://github.com/thunks/tman</a></p>
<h3 id="Gridcontrol-——-networked-process-managers"><a href="#Gridcontrol-——-networked-process-managers" class="headerlink" title="Gridcontrol —— networked process managers"></a>Gridcontrol —— networked process managers</h3><p>pm2作者Alexandre！大神就是大神，说开源就开源，而且还是现场开源，这里有关于gridcontrol的介绍：</p>
<blockquote>
<p> GridControl is a network layer built on top of PM2 allowing file synchronization, inter-process communication via an opionated PUB/SUB system and a wide-range system discovery</p>
</blockquote>
<p>github地址：<br><a href="https://github.com/gridcontrol/gridcontrol" target="_blank" rel="external">https://github.com/gridcontrol/gridcontrol</a>  </p>
<h3 id="3D-on-the-web"><a href="#3D-on-the-web" class="headerlink" title="3D on the web"></a>3D on the web</h3><p>讲师中唯一的妹子，而且英文讲的超棒。首先妹子介绍了如何使用WebGL画一个三角形，然后就是three.js的介绍，最后的demo让在场所有人感受到了web 3D的酷炫。<br>github地址：<br><a href="http://developer-autodesk.github.io" target="_blank" rel="external">http://developer-autodesk.github.io</a>  </p>
<h3 id="A-Frame-Building-Virtual-Reality-on-the-Web"><a href="#A-Frame-Building-Virtual-Reality-on-the-Web" class="headerlink" title="A-Frame, Building Virtual Reality on the Web"></a>A-Frame, Building Virtual Reality on the Web</h3><p>Kevin Ngo是WebVR的布道者，也是A-Frame的核心开发成员。WebVR的概念对我来说是非常新颖的，首先Kevin介绍了WebVR以及WebVR的一些现状<br>其次介绍了一个基于three.js的框架－－A-Frame，通过声明式的HTML来创建场景。比如实现 一个3D盒子：</p>
<pre><code>&lt;a-scene&gt;
      &lt;a-box position=&quot;-1 0.5 1&quot; rotation=&quot;0 45 0&quot; width=&quot;1&quot; height=&quot;1&quot; depth=&quot;1&quot;  color=&quot;#4CC3D9&quot;&gt;&lt;/a-box&gt;
      &lt;a-plane rotation=&quot;-90 0 0&quot; width=&quot;4&quot; height=&quot;4&quot; color=&quot;#7BC8A4&quot;&gt;&lt;/a-plane&gt;

      &lt;a-sky color=&quot;#ECECEC&quot;&gt;&lt;/a-sky&gt;
      &lt;a-entity position=&quot;0 0 3.8&quot;&gt;
        &lt;a-camera&gt;&lt;/a-camera&gt;
      &lt;/a-entity&gt;
&lt;/a-scene&gt;
</code></pre><p>具体可以参考官方地址：<br><a href="https://aframe.io" target="_blank" rel="external">https://aframe.io</a></p>
<h3 id="Building-a-Unified-Frontend-and-Mobile-Team"><a href="#Building-a-Unified-Frontend-and-Mobile-Team" class="headerlink" title="Building a Unified Frontend and Mobile Team"></a>Building a Unified Frontend and Mobile Team</h3><p>这个分享主要说的是react,react native的，介绍了通过UI层的虚拟机，来屏蔽各端的差异，用RN搞定web、android、ios三端的开发，不过即使如此，这还是不能抛开原生的影响，也就是说未来RN可以融合其他端，但是这只是在某些特定的业务场景下。  </p>
<h3 id="Building-asynchronous-microservices-that-get-along"><a href="#Building-asynchronous-microservices-that-get-along" class="headerlink" title="Building asynchronous microservices that get along"></a>Building asynchronous microservices that get along</h3><p> 讲师解释了microservices的概念，以及microservices的交互（restful接口，消息中间件、任务系统），然后是microservices面临的一些问题（请求变重、API数量暴增），最后以订单&amp;支付为例子，介绍了一些问题以及解决方案。</p>
<p> 最后附上我和大神的合影:)</p>
<p> <img src="https://avatars1.githubusercontent.com/u/11830681?v=3&amp;s=460" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;第一次参加JSconf，也是我第一次来南京这座城市，这座有着丰富的文化历史底蕴的城市。参加这次JSconf心情是十分激动的，见到来自各地的开发者，感受他们分享的经历与成长，这对我自身也有很大激励与启发。下面就是我对参加峰会的记录整理。&lt;/p&gt;
&lt;h2 id=&quot;9月3日&quot;&gt;&lt;
    
    </summary>
    
    
      <category term="life" scheme="http://yoursite.com/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>Understanding Event Loop</title>
    <link href="http://yoursite.com/2016/08/16/Understanding-Event-Loop/"/>
    <id>http://yoursite.com/2016/08/16/Understanding-Event-Loop/</id>
    <published>2016-08-16T06:58:53.000Z</published>
    <updated>2016-12-08T07:16:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>前段时间看了 Philip Roberts 关于event-loop的演讲视频</p>
<blockquote>
<p>传送门：<br>YouTube:<a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ" target="_blank" rel="external"> Philip Roberts: What the heck is the event loop anyway? | JSConf EU 2014</a><br>Vimeo: <a href="https://vimeo.com/96425312" target="_blank" rel="external">Philip Roberts: Help, I’m stuck in an event-loop</a></p>
</blockquote>
<p>决定总结整理一下自己对event-loop的理解。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前段时间看了 Philip Roberts 关于event-loop的演讲视频&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;传送门：&lt;br&gt;YouTube:&lt;a href=&quot;https://www.youtube.com/watch?v=8aGhZQkoFbQ&quot; target=
    
    </summary>
    
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>Web Real-time Connection</title>
    <link href="http://yoursite.com/2016/08/02/Web-Real-Time-Connection/"/>
    <id>http://yoursite.com/2016/08/02/Web-Real-Time-Connection/</id>
    <published>2016-08-02T13:30:13.000Z</published>
    <updated>2016-12-08T07:17:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>关于web实时通信，我们都知道通常是使用长轮询或者长连接这种方式。 本文是对几种web实时通信进行简单的总结介绍，仅供参考。</p>
<h3 id="Ajax-long-polling"><a href="#Ajax-long-polling" class="headerlink" title="Ajax long polling"></a>Ajax long polling</h3><p>传统的轮询方式是客户端定时(一般使用setInterval)向服务器发送ajax请求，服务器收到请求后马上响应信息。这种方式在客户端和服务端都很好实现，但是会造成很多无用的请求，当服务器没有可返回的数据时，这次请求就浪费了。<br>而长轮询，则是客户端向服务器发送Ajax请求，<strong>服务器接到请求后保持住连接</strong>，直到有新消息才返回响应信息，客户端处理完响应信息后再向服务器发送新的请求。<br>当然使用长轮询，客户端和服务端需要具备以下的条件:  </p>
<ul>
<li>客户端在收到服务器的响应后，需要向服务器发送新的请求，从而达到轮询的效果  </li>
<li>服务器端要能够一直保持住客户端的请求，直到有响应消息；同时服务器对请求的处理要支持非阻塞模式  </li>
</ul>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/websocket1.png" alt=""></p>
<h3 id="Server-sent-Events-SSE"><a href="#Server-sent-Events-SSE" class="headerlink" title="Server-sent Events(SSE)"></a>Server-sent Events(SSE)</h3><p>SSE是HTML5规范的一个组成部分，简单点说，就是客户端向服务端发送一个HTTP请求，然后服务端不断<strong>单向</strong>地向客户端推送信息(message)。这种信息在格式上也很简单，就是“信息”加上前缀“data: ”，然后以“\n\n”结尾: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ curl http://example.com/dates</div><div class="line">data: 1394572346452</div><div class="line"></div><div class="line">data: 1394572347457</div><div class="line"></div><div class="line">data: 1394572348463</div><div class="line"></div><div class="line">^C</div></pre></td></tr></table></figure>
<p>也就是说，当数据源有新数据的时候，服务器端能立刻发送给一个或多个客户端，而不用等客户端来请求，这些新数据可能是实时新闻、最新股票、上线朋友的聊天信息等等。<br><img src="http://7xl0rs.com1.z0.glb.clouddn.com/websocket2.png" alt=""></p>
<h3 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h3><p>在HTML5中，还提供了一种叫做Websocket的技术，它不仅仅是一种web通信方式，而且也是一种应用层的协议。 它和前文提到的SSE一样都是用来建立客户端和服务端之间的通信渠道，不过两者最大的区别在于： </p>
<ul>
<li><p>Websocket提供了客户端和服务端之间的全双工跨域通信，在同一时刻能够实现客户端到服务器和服务器到客户端的数据发送;而SSE是单向通道，只能服务器向浏览器端发送;</p>
</li>
<li><p>Websocket是一个新的协议（其实是基于TCP协议），需要服务端的支持；而SSE则是部署在HTTP协议之上的</p>
</li>
<li>SSE是一个轻量级协议，相对简单；WebSocket是一种较重的协议，相对复杂。</li>
</ul>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/websocket3.png" alt="">  </p>
<p>可以看出，两者虽然功能相似，但是各有特点，适合于不同的场合。关于更多websocket的内容，可以参考<a href="http://www.websocket.org/aboutwebsocket.html" target="_blank" rel="external">websocket.org</a>   </p>
<h3 id="Socket-io"><a href="#Socket-io" class="headerlink" title="Socket.io"></a>Socket.io</h3><p>因为不是所有浏览器都支持Websocket标准，所以为了解决这个问题，Socket.io便诞生了。<br>Socket.io是基于node.js生态系统，是对Node.js关于支持WebSocket协议所有API的封装和拓展，完全由js实现。<br>同时，Socket.io设计的目标是支持任何的浏览器和任何设备。于是在接口方面，Socket.io统一了通信的API，在内部支持一系列降级功能：  </p>
<ul>
<li>WebSocket</li>
<li>AJAX long-polling </li>
<li>AJAX multipart streaming</li>
<li>Forever Iframe</li>
<li>Adobe® Flash® Socket</li>
<li>JSONP Polling</li>
</ul>
<p>也就是说，Socket.io会根据环境来选择适合的通信方式。这点是十分强大的。<br>而搭建Socket.io环境也十分简单，首先需要创建一个作为工作空间的目录，然后安装Node.js，并在工作空间下安装Socket.io(命令：npm install socket.io)，这样环境已经搭建完成。还可以安装基于Node.js框架(如Express.js等)以协助应用的服务器端开发。   具体可以参考我用<a href="http://socket.io" target="_blank" rel="external">socket.io</a> &amp;&amp; express 写的一个<a href="https://github.com/stephenLYao/chatroom" target="_blank" rel="external">简易的聊天室</a>程序。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于web实时通信，我们都知道通常是使用长轮询或者长连接这种方式。 本文是对几种web实时通信进行简单的总结介绍，仅供参考。&lt;/p&gt;
&lt;h3 id=&quot;Ajax-long-polling&quot;&gt;&lt;a href=&quot;#Ajax-long-polling&quot; class=&quot;headerl
    
    </summary>
    
    
      <category term="web" scheme="http://yoursite.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>初识WebPageTest</title>
    <link href="http://yoursite.com/2016/07/27/%E5%88%9D%E8%AF%86WebpageTest/"/>
    <id>http://yoursite.com/2016/07/27/初识WebpageTest/</id>
    <published>2016-07-27T05:30:04.000Z</published>
    <updated>2016-11-23T16:36:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>基本上在讨论网站性能分析工具的时候，就一定会提到<a href="http://www.webpagetest.org" target="_blank" rel="external">WebpageTest</a>这个工具，顾名思义，它的核心是测量以及分析一个网站的性能，下面以我参与的一个产品<a href="book.muxistudio.com">木犀图书</a>为例，介绍一下WebPageTest的内容。  </p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>当你输入你想要测量的网站后，等待一段时间（可能是喝一口咖啡的时间），就会出现网站一些关键数据信息的展示，右上角是对一些重要的性能优化评分，其中包括Keep-alive Enabled、Compress Text、Compress Images、Cache Static Content、Combine JS/CSS Files以及Use of CDN。<br><img src="http://7xl0rs.com1.z0.glb.clouddn.com/webpage1.png" alt="">  </p>
<ul>
<li>下方就是一些关键的数据信息展示，包含 Load Time、First Byte、Start Render、DOM Elements 等 ，其中最大的特点就是会分为 <strong>首次加载以及再次加载</strong></li>
</ul>
<blockquote>
<p>note: 首次加载是指浏览器中的缓存以及cookie全部清除，即第一次浏览该网页；再次加载是指在首次加载的基础上没有清除任何东西的加载网页。</p>
</blockquote>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/webpage2.png" alt="">  </p>
<ul>
<li>除此之外，detail选项中会展现每个请求不同阶段占用时间对比，类似于Chrome浏览器的瀑布流，以及每个请求的 detail、request、response、object 信息。</li>
</ul>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/webpage3.png" alt="">  </p>
<ul>
<li>Performance Review,一些刚提过的必要性能检查，关于每个性能的解释可以查看<a href="https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/quick-start-quide#TOC-Optimization-Grades:" target="_blank" rel="external">文档</a>  </li>
</ul>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/webpage4.png" alt=""></p>
<ul>
<li>Content breakdown, 不同资源的请求数以及请求类型 </li>
</ul>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/webpage5.png" alt=""></p>
<ul>
<li>Domains,域名分析，域名越多消耗的 DNS 查询时间就越长。由于这个产品只有一个域名，所以只显示一个</li>
</ul>
<p><img src="http://7xl0rs.com1.z0.glb.clouddn.com/webpage6.png" alt=""></p>
<p>个人认为，这个工具的优点有这几点:</p>
<ul>
<li>内容上，首次加载以及再次加载的对比可以让性能优化更具有针对性，测量标准也是按照最佳实践，比如Compress Images、Cache Static Content等。</li>
<li>展示上，各项加载时间指标以及图表、瀑布图的使用让数据更为直观。</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;基本上在讨论网站性能分析工具的时候，就一定会提到&lt;a href=&quot;http://www.webpagetest.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;WebpageTest&lt;/a&gt;这个工具，顾名思义，它的核心是测量以及分析一个网站的性能，下
    
    </summary>
    
    
      <category term="web性能" scheme="http://yoursite.com/tags/web%E6%80%A7%E8%83%BD/"/>
    
  </entry>
  
  <entry>
    <title>Module.exports vs Exports in Node.js</title>
    <link href="http://yoursite.com/2016/07/25/module.exports%20vs%20exports%20in%20Node.js/"/>
    <id>http://yoursite.com/2016/07/25/module.exports vs exports in Node.js/</id>
    <published>2016-07-24T16:00:00.000Z</published>
    <updated>2016-12-08T07:16:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近在折腾node.js的时候，经常会看到类似<code>exports.xxx = yyy</code>以及<code>module.exports = yyy</code>这样的代码，可实际上如果通过require()函数来引用模块就会有报错的情况，所以到底是什么原因造成的呢？这两者又有什么区别？<br>关于两者的区别，了解了下面几点就会非常的清楚:</p>
<ul>
<li><code>exports</code> 是 <code>module.exports</code> 的一个引用 <code>exports = module.exports = {}</code></li>
<li><code>require()</code>返回的是<code>module.exports</code> 而不是 <code>exports</code></li>
<li><code>exports.xxx</code> 相当于在导出对象上挂属性，该属性对调用模块直接可见</li>
<li><code>exports =</code>相当于给exports对象重新赋值，调用模块不能访问<code>exports</code> 对象及其属性</li>
<li>如果此模块是一个类，就应该直接赋值给<code>module.exports</code>,这样调用者就是一个类构造器，可以直接使用new实例化；如果只导出简单的属性，可以直接挂载到<code>exports</code>上</li>
</ul>
<p>比如以下代码计算圆的面积：</p>
<p><strong>使用exports</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// circle.js</span></div><div class="line">exports.area = <span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> r*r*<span class="number">3</span></div><div class="line">&#125; ;</div><div class="line"></div><div class="line"><span class="comment">//app.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle'</span>)</div><div class="line"><span class="built_in">console</span>.log(circle.area(<span class="number">2</span>))</div><div class="line"></div><div class="line"><span class="comment">//输出 '12'</span></div></pre></td></tr></table></figure>
<p><strong>使用module.exports</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// area.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> r*r*<span class="number">3</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//app.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> area = <span class="built_in">require</span>(<span class="string">'./area'</span>)</div><div class="line"><span class="built_in">console</span>.log(area(<span class="number">2</span>))</div><div class="line"></div><div class="line"><span class="comment">//输出 '12'</span></div></pre></td></tr></table></figure>
<p>两者输出是一样的，因为<code>exports</code>是<code>module.exports</code>的一个引用，所以两者指向的内存地址是一样的，可是如果你这样写:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// area.js</span></div><div class="line">exports = <span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> r*r*<span class="number">3</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//app.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> area = <span class="built_in">require</span>(<span class="string">'./area'</span>)</div><div class="line"><span class="built_in">console</span>.log(area(<span class="number">2</span>))</div><div class="line"></div><div class="line"><span class="comment">//输出 'TypeError: object is not a function'</span></div></pre></td></tr></table></figure>
<p>我们可以看到是报错的，原因在于，之前说过<code>require()</code>返回的只是<code>module.exports</code>,而<code>exports</code>是<code>module.exports</code>的一个引用，上面代码给<code>exports</code>重新赋值，使其指向了新的内存地址，此时<code>exports</code>和<code>module.exports</code>毫无关系，也就是说此时<code>module.exports</code>的值为默认值{}，所以导出的是一个空对象。   </p>
<p>也就是说，<code>module.exports</code>才是关键，而<code>exports</code>只是起辅助的作用,最终导出来的是<code>module.exports</code>上挂载的对象，当<code>module.exports</code>没有任何值时，<code>exports</code>挂载的属性会赋值给<code>module.exports</code>, 当<code>module.exports</code>具有挂载的对象时，<code>exports</code>上的所有值会被忽略，比如以下代码只输出了<code>module.exports</code>所挂载的属性:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//rock.js</span></div><div class="line"><span class="built_in">module</span>.exports.name = <span class="string">'Stephen'</span></div><div class="line">exports.name = <span class="string">'Mike'</span></div><div class="line"></div><div class="line"><span class="comment">//app.js</span></div><div class="line"><span class="keyword">var</span> rock = <span class="built_in">require</span>(<span class="string">'./rock.js'</span>)</div><div class="line">rock.name</div><div class="line"></div><div class="line"><span class="comment">//输出</span></div><div class="line"><span class="string">'Stephen'</span></div></pre></td></tr></table></figure>
<p>总结一下:</p>
<ul>
<li>如果要导出非对象接口（属性），可以直接使用<code>exports</code></li>
<li>如果要导出对象接口(类)，应该将其挂载到<code>module.exports</code>上面，从而可以直接让调用者new实例化对象</li>
</ul>
<p>参考：<br><a href="https://cnodejs.org/topic/5231a630101e574521e45ef8" target="_blank" rel="external">exports 和 module.exports 的区别</a><br><a href="http://www.hacksparrow.com/node-js-exports-vs-module-exports.html" target="_blank" rel="external">node-js-exports-vs-module-exports</a><br><a href="http://www.ghostchina.com/module-exports-and-exports-in-node-js/" target="_blank" rel="external">module-exports-and-exports-in-node-js</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在折腾node.js的时候，经常会看到类似&lt;code&gt;exports.xxx = yyy&lt;/code&gt;以及&lt;code&gt;module.exports = yyy&lt;/code&gt;这样的代码，可实际上如果通过require()函数来引用模块就会有报错的情况，所以到底是什么原因造
    
    </summary>
    
    
      <category term="nodeJs" scheme="http://yoursite.com/tags/nodeJs/"/>
    
  </entry>
  
  <entry>
    <title>bootstrap之CSS源码分析</title>
    <link href="http://yoursite.com/2016/02/05/bootstrap-CSS-source-analysis/"/>
    <id>http://yoursite.com/2016/02/05/bootstrap-CSS-source-analysis/</id>
    <published>2016-02-05T02:18:40.000Z</published>
    <updated>2016-07-25T08:04:18.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p><a href="http://getbootstrap.com/2.3.2/" target="_blank" rel="external">Bootstrap</a>作为到目前为止世界上最流行的CSS开发框架吸引了很多开发者。不过对于前端开发者来说，我觉得bootstrap的意义还是在于其代码设计理念以及思路。这篇post主要分析其中的部分CSS源码(版本是<strong>bootstrap-4.0.0-alpha</strong>，其中CSS具体数据可以通过<a href="http://www.cssstats.com" target="_blank" rel="external">css stats</a>测得）。Bootstrap3版本之前是基于Less来编译的，但到了4.0-alpha版本就开始正式使用Sass。<br>我们可以看到scss目录结构大致是这样的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">bootstrap/</div><div class="line">|– bootstrap.scss   # Manifest file </div><div class="line">|– _alerts.scss     # Component file </div><div class="line">|– _buttons.scss    # Component file </div><div class="line">|– _mixins.scss     # Mixin file – imports all files from mixins folder</div><div class="line">|–  ...             # Etc..</div><div class="line">|– mixins/</div><div class="line">|  |–  _alerts.scss # Alert mixin</div><div class="line">|  |– _buttons.scss # Button mixin</div><div class="line">|  |– ...           # Etc.</div></pre></td></tr></table></figure>
<p>从整体的文件结构也可以看出bootstrap组件化以及层次化的特点。<br>接下来我将从三个方面进行分析：  </p>
<ul>
<li>CSS Specificity Graph</li>
<li>Grid源码分析</li>
<li>Normalize.css</li>
</ul>
<h3 id="一、CSS-Specificity-Graph"><a href="#一、CSS-Specificity-Graph" class="headerlink" title="一、CSS Specificity Graph"></a>一、CSS Specificity Graph</h3><p>Bootstrap中CSS选择器的类型就有两千多种，我们知道在构建自己项目的时候，有一个问题我们必须十分注意：<strong>CSS Specificity</strong>。这时候我们可以利用一个可视化工具－－<a href="https://jonassebastianohlsson.com/specificity-graph/" target="_blank" rel="external">CSS Specificity Graph</a>来大致的查看整个项目的CSS Specificity。我认为Bootstrap中CSS Specificity分布还是比较合理的，从整体上看Bootstrap中CSS Specificity大致分布是这样的：<br><img src="http://7xl0rs.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-03%2011.59.37.png" alt="曲线"><br>曲线比较粗略的描绘了整个CSS Specificity的分布情况，x轴指的选择器，y轴是权重值。现在我们来分析一下这条曲线，整体上看权重值主要分布在中段（20～30），而最高值达到了60，最低值为1。<br>在前一小段，我们可以清楚的看到权重值普遍低于10，类似于这样类型的选择器：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//权重为1</span></div><div class="line"><span class="selector-tag">html</span> </div><div class="line"><span class="selector-tag">body</span>  </div><div class="line"><span class="selector-tag">article</span>,</div><div class="line"><span class="selector-tag">aside</span>,</div><div class="line"><span class="selector-tag">details</span>,</div><div class="line"><span class="selector-tag">figcaption</span>,</div><div class="line"><span class="selector-tag">figure</span>,</div><div class="line"><span class="selector-tag">footer</span>,</div><div class="line"><span class="selector-tag">header</span>,</div><div class="line"><span class="selector-tag">hgroup</span>,</div><div class="line">main,</div><div class="line">menu,</div><div class="line">....</div><div class="line"><span class="comment">//权重为10左右</span></div><div class="line"><span class="selector-tag">html</span> <span class="selector-tag">input</span><span class="selector-attr">[type="button"]</span>, </div><div class="line"><span class="selector-tag">input</span><span class="selector-attr">[type="reset"]</span>,</div><div class="line"><span class="selector-tag">input</span><span class="selector-attr">[type="submit"]</span>,</div><div class="line"><span class="selector-tag">abbr</span><span class="selector-attr">[data-original-title]</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>也就是前部分基本上是一些元素或属性选择器。而到了中间有一段平缓区，这部分是栅格系统的选择器:  </p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.col-xs-1</span>,<span class="selector-class">.col-sm-1</span>,<span class="selector-class">.col-md-1</span>,<span class="selector-class">.col-lg-1</span>,</div><div class="line"><span class="selector-class">.col-xs-2</span>,<span class="selector-class">.col-sm-2</span>,<span class="selector-class">.col-md-2</span>,<span class="selector-class">.col-lg-2</span>,</div><div class="line"><span class="selector-class">.col-xs-3</span>,<span class="selector-class">.col-sm-3</span>,<span class="selector-class">.col-md-3</span>,<span class="selector-class">.col-lg-3</span>,</div><div class="line"><span class="selector-class">.col-xs-4</span>,<span class="selector-class">.col-sm-4</span>,<span class="selector-class">.col-md-4</span>,<span class="selector-class">.col-lg-4</span>,</div><div class="line"><span class="selector-class">.col-xs-5</span>,<span class="selector-class">.col-sm-5</span>,<span class="selector-class">.col-md-5</span>,<span class="selector-class">.col-lg-5</span>,</div><div class="line"><span class="selector-class">.col-xs-6</span>,<span class="selector-class">.col-sm-6</span>,<span class="selector-class">.col-md-6</span>,<span class="selector-class">.col-lg-6</span>,</div><div class="line"><span class="selector-class">.col-xs-7</span>,<span class="selector-class">.col-sm-7</span>,<span class="selector-class">.col-md-7</span>,<span class="selector-class">.col-lg-7</span>,</div><div class="line">...</div></pre></td></tr></table></figure>
<p>随后就是相对复杂的各组件选择器：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//最低达到10</span></div><div class="line"><span class="selector-class">.btn</span>,</div><div class="line"><span class="selector-class">.btn-link</span>,</div><div class="line"><span class="selector-class">.form-control</span>,</div><div class="line">....</div><div class="line"></div><div class="line"><span class="comment">//最高达到60</span></div><div class="line"><span class="selector-class">.btn-group</span> &gt; <span class="selector-class">.btn-group</span>:last-child:not(:first-child) &gt; <span class="selector-class">.btn</span>:first-child</div><div class="line"><span class="selector-class">.btn-group-vertical</span> &gt; <span class="selector-class">.btn-group</span>:first-child:not(:last-child) &gt; <span class="selector-class">.dropdown-toggle</span></div><div class="line"><span class="selector-class">.btn-group</span> &gt; <span class="selector-class">.btn</span>:not(:first-child):not(:last-child):not(<span class="selector-class">.dropdown-toggle</span>)</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>
<p>总体来说整个曲线是向上的趋势，不过问题也很明显，也就是曲线比较曲折，而我们说一个良好的权重曲线是平缓且向上趋势的，即把权重低的选择器放在最前面，高权重的选择器放在后面，也就是说我们希望曲线不会出现尖峰。由于bootstrap使用的是组件化的思想，所以我们再具体化分别对button、nav、list、table组件进行分析：</p>
<div class="row"><div class="col-sm-6">button组件</div><div class="col-sm-6">nav组件</div></div><br><div class="row"><br><div class="col-sm-6"><img src="http://7xl0rs.com1.z0.glb.clouddn.com/btn.png" alt="btn"></div><div class="col-sm-6"><img src="http://7xl0rs.com1.z0.glb.clouddn.com/nav.png" alt="nav"></div><br></div><br><div class="row"><div class="col-sm-6">table组件</div><div class="col-sm-6">list组件</div></div><br><div class="row"><br><div class="col-sm-6"><img src="http://7xl0rs.com1.z0.glb.clouddn.com/table.png" alt="btn"></div><div class="col-sm-6"><img src="http://7xl0rs.com1.z0.glb.clouddn.com/list.png" alt="nav"></div><br></div>

<p>每个组件曲线依然是相对曲折的，不过我们发现CSS Specificity的分布具有一定周期性，尤其是button组件特别明显。原因其实也很简单－－组件中还分为更小的组件(也不完全叫做组件)，比如以button为例：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//.btn还分为更小的部分</span></div><div class="line">...</div><div class="line"><span class="selector-class">.btn-primary</span>&#123;&#125;</div><div class="line">...</div><div class="line"><span class="selector-class">.btn-danger</span>&#123;&#125;</div><div class="line">...</div><div class="line"><span class="selector-class">.btn-info</span>&#123;&#125;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>这也是为什么每到一个阶段就会出现一个最低点,我们以<code>.btn-primary</code>为例来看一下更为小的组件：<br><img src="http://7xl0rs.com1.z0.glb.clouddn.com/btn-primary.png" alt="btn-primary">  </p>
<p>其中源代码为：  </p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.btn-primary</span> &#123;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</div><div class="line">  <span class="attribute">background-color</span>: <span class="number">#0275d8</span>;</div><div class="line">  <span class="attribute">border-color</span>: <span class="number">#0275d8</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.btn-primary</span>:focus,</div><div class="line"><span class="selector-class">.btn-primary</span><span class="selector-class">.focus</span>,</div><div class="line"><span class="selector-class">.btn-primary</span>:active,</div><div class="line"><span class="selector-class">.btn-primary</span><span class="selector-class">.active</span>,</div><div class="line"><span class="selector-class">.open</span> &gt; <span class="selector-class">.btn-primary</span><span class="selector-class">.dropdown-toggle</span> &#123;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</div><div class="line">  <span class="attribute">background-color</span>: <span class="number">#025aa5</span>;</div><div class="line">  <span class="attribute">border-color</span>: <span class="number">#01549b</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.btn-primary</span>:hover &#123;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</div><div class="line">  <span class="attribute">background-color</span>: <span class="number">#025aa5</span>;</div><div class="line">  <span class="attribute">border-color</span>: <span class="number">#01549b</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.btn-primary</span>:active,</div><div class="line"><span class="selector-class">.btn-primary</span><span class="selector-class">.active</span>,</div><div class="line"><span class="selector-class">.open</span> &gt; <span class="selector-class">.btn-primary</span><span class="selector-class">.dropdown-toggle</span> &#123;</div><div class="line">  <span class="attribute">background-image</span>: none;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.btn-primary</span><span class="selector-class">.disabled</span>:focus,</div><div class="line"><span class="selector-class">.btn-primary</span><span class="selector-class">.disabled</span><span class="selector-class">.focus</span>,</div><div class="line"><span class="selector-class">.btn-primary</span>:disabled:focus,</div><div class="line"><span class="selector-class">.btn-primary</span>:disabled<span class="selector-class">.focus</span>,</div><div class="line"><span class="selector-tag">fieldset</span><span class="selector-attr">[disabled]</span> <span class="selector-class">.btn-primary</span>:focus,</div><div class="line"><span class="selector-tag">fieldset</span><span class="selector-attr">[disabled]</span> <span class="selector-class">.btn-primary</span><span class="selector-class">.focus</span> &#123;</div><div class="line">  <span class="attribute">background-color</span>: <span class="number">#0275d8</span>;</div><div class="line">  <span class="attribute">border-color</span>: <span class="number">#0275d8</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.btn-primary</span><span class="selector-class">.disabled</span>:hover,</div><div class="line"><span class="selector-class">.btn-primary</span>:disabled:hover,</div><div class="line"><span class="selector-tag">fieldset</span><span class="selector-attr">[disabled]</span> <span class="selector-class">.btn-primary</span>:hover &#123;</div><div class="line">  <span class="attribute">background-color</span>: <span class="number">#0275d8</span>;</div><div class="line">  <span class="attribute">border-color</span>: <span class="number">#0275d8</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从曲线可以看到小组件的趋势是相对平缓且上升的，这也说明bootstrap的权重曲线设计是比较合理的。而我们在构建自己的项目的时候，最合适的模式就是使得项目的CSS Specificity曲线平缓且上升的趋势，避免出现尖峰的情况。<br>想了解更多有关css specificity graph，可以看<a href="http://csswizardry.com/2014/10/the-specificity-graph/" target="_blank" rel="external">这篇文章</a>。</p>
<h3 id="二、Grid-System"><a href="#二、Grid-System" class="headerlink" title="二、Grid System"></a>二、Grid System</h3><p>在分析Bootstrap的Grid Systemt之前我们先看一下_variables.scss中所涉及的变量：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//_variables.scss</span></div><div class="line"><span class="variable">$grid-breakpoints</span>: (</div><div class="line">  // Extra small screen / phone</div><div class="line">  xs: <span class="number">0</span>,</div><div class="line">  // Small screen / phone</div><div class="line">  sm: <span class="number">34em</span>,</div><div class="line">  // Medium screen / tablet</div><div class="line">  md: <span class="number">48em</span>,</div><div class="line">  // Large screen / desktop</div><div class="line">  lg: <span class="number">62em</span>,</div><div class="line">  // Extra large screen / wide desktop</div><div class="line">  xl: <span class="number">75em</span></div><div class="line">) !default;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Grid containers</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// 对于不同的屏幕尺寸设置'.container'的最大宽度</span></div><div class="line"></div><div class="line"><span class="variable">$container-max-widths</span>: (</div><div class="line">  sm: <span class="number">34rem</span>,    // <span class="number">480</span></div><div class="line">  md: <span class="number">45rem</span>,    // <span class="number">720</span></div><div class="line">  lg: <span class="number">60rem</span>,    // <span class="number">960</span></div><div class="line">  xl: <span class="number">72.25rem</span>  // <span class="number">1140</span></div><div class="line">) !default;</div><div class="line"></div><div class="line">``` </div><div class="line">其中<span class="variable">$grid-breakpoints</span>的作用是当你选择哪种方式布局时，从而让Grid系统适应各种屏幕尺寸。我们都知道Grid总列数为12列，列与列的宽度为30px(30px分为两部分，分别应用与相邻的两列),这是通过以下变量定义：</div><div class="line"></div><div class="line">```scss</div><div class="line"></div><div class="line"><span class="comment">// Grid columns</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// 设置列数以及列与列之间的间隔</span></div><div class="line"></div><div class="line"><span class="variable">$grid-columns</span>:               <span class="number">12</span> !default;</div><div class="line"><span class="variable">$grid-gutter-width</span>:          <span class="number">1.875rem</span> !default; <span class="comment">// 30px</span></div></pre></td></tr></table></figure>
<p>Bootstrap提供两种布局：固定布局与流式布局,实际上就是在外面加了一个容器(container)，固定布局就是container的宽度时固定的，流式布局的container是自适应的。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//_grid.scss</span></div><div class="line"><span class="comment">// 设置container的固定宽度</span></div><div class="line"></div><div class="line"><span class="selector-class">.container</span> &#123;</div><div class="line">  @<span class="keyword">include</span> make-container();</div><div class="line"></div><div class="line">  <span class="comment">//对于不同的屏幕尺寸，通过媒体查询来定义每个container的最大宽度</span></div><div class="line">  @<span class="keyword">each</span> <span class="variable">$breakpoint</span>, <span class="variable">$container-max-width</span> in <span class="variable">$container-max-widths</span> &#123;</div><div class="line">    @<span class="keyword">include</span> media-breakpoint-up(<span class="variable">$breakpoint</span>) &#123;</div><div class="line">      <span class="attribute">max-width</span>: <span class="variable">$container-max-width</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Fluid container</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//利用mixin的方法来设置流式布局</span></div><div class="line"></div><div class="line"><span class="selector-class">.container-fluid</span> &#123;</div><div class="line">  @<span class="keyword">include</span> make-container();</div><div class="line">&#125;</div><div class="line"><span class="comment">// Row</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// 定义row并且清楚列与列之间的浮动</span></div><div class="line"></div><div class="line"><span class="selector-class">.row</span> &#123;</div><div class="line">  @<span class="keyword">include</span> make-row();</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Columns</span></div><div class="line"></div><div class="line">@<span class="keyword">include</span> make-grid-columns();</div></pre></td></tr></table></figure>
<p>再来看一下@mixin make-container和@mixin make-row:</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//_grid.scss/mixin</span></div><div class="line">@<span class="keyword">mixin</span> make-container(<span class="variable">$gutter</span>: <span class="variable">$grid-gutter-width</span>) &#123;</div><div class="line">  <span class="attribute">margin-right</span>: auto;</div><div class="line">  <span class="attribute">margin-left</span>: auto;</div><div class="line">  <span class="attribute">padding-left</span>:  (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line">  <span class="attribute">padding-right</span>: (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line">  @<span class="keyword">include</span> clearfix();</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="keyword">mixin</span> make-row(<span class="variable">$gutter</span>: <span class="variable">$grid-gutter-width</span>) &#123;</div><div class="line">  @<span class="keyword">if</span> <span class="variable">$enable-flex</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">    <span class="attribute">flex-wrap</span>: wrap;</div><div class="line">  &#125; @<span class="keyword">else</span> &#123;</div><div class="line">    @<span class="keyword">include</span> clearfix();</div><div class="line">  &#125;</div><div class="line">  <span class="attribute">margin-left</span>:  (<span class="variable">$gutter</span> / -<span class="number">2</span>);</div><div class="line">  <span class="attribute">margin-right</span>: (<span class="variable">$gutter</span> / -<span class="number">2</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>row中的负margin是对container的padding修正，为什么要这么做呢？我们可以看一下如何定义col的：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">mixin</span> make-col(<span class="variable">$gutter</span>: <span class="variable">$grid-gutter-width</span>) &#123;</div><div class="line">  <span class="attribute">position</span>: relative;</div><div class="line">  @<span class="keyword">if</span> <span class="variable">$enable-flex</span> &#123;</div><div class="line">    <span class="comment">// Do nothing</span></div><div class="line">  &#125; @<span class="keyword">else</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">  &#125;</div><div class="line">  <span class="attribute">min-height</span>: <span class="number">1px</span>;</div><div class="line">  <span class="attribute">padding-left</span>:  (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line">  <span class="attribute">padding-right</span>: (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里的col也设置了padding，我们都知道列可以嵌套列，也就是说col里面可以加一层row，这样就使得col相当于一个container，从而实现嵌套，是不是很微妙？具体可以看一下<a href="http://stephenlyao.github.io/2016/03/15/bootstrap-Grid-System-Magic/" target="_blank" rel="external">这篇文章</a> .<br>我们知道bootstrap的列示通过类似<code>.col-xs-1</code>,<code>.col-sm-1</code>,<code>col-md-1</code>,<code>col-lg-1</code>…这样的类名定义的，也就是说class被分为四种分辨率，每种分辨率有12个数字，这样就有48种类名，当然除去pull,push,offset，数量是十分多的。所以为了方便编码，sass用了迭代来产生css。首先通过一个占位符设置通用属性：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Common properties for all breakpoints</span></div><div class="line">%grid-column &#123;</div><div class="line">  <span class="attribute">position</span>: relative;</div><div class="line">  <span class="comment">// Prevent columns from collapsing when empty</span></div><div class="line">  <span class="attribute">min-height</span>: <span class="number">1px</span>;</div><div class="line">  <span class="comment">// Inner gutter via padding</span></div><div class="line">  <span class="attribute">padding-left</span>: (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line">  <span class="attribute">padding-right</span>: (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后通过两层迭代来设置col：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$breakpoints</span>) &#123;</div><div class="line">  @<span class="keyword">for</span> <span class="variable">$i</span> from 1 through <span class="variable">$columns</span> &#123;</div><div class="line">    <span class="selector-class">.col-</span>#&#123;<span class="variable">$breakpoint</span>&#125;-#&#123;<span class="variable">$i</span>&#125; &#123;</div><div class="line">      @<span class="keyword">extend</span> %grid-column;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出结果为： </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.col-xs-1</span>,<span class="selector-class">.col-sm-1</span>,<span class="selector-class">.col-md-1</span>,<span class="selector-class">.col-lg-1</span>,</div><div class="line"><span class="selector-class">.col-xs-2</span>,<span class="selector-class">.col-sm-2</span>,<span class="selector-class">.col-md-2</span>,<span class="selector-class">.col-lg-2</span>,</div><div class="line"><span class="selector-class">.col-xs-3</span>,<span class="selector-class">.col-sm-3</span>,<span class="selector-class">.col-md-3</span>,<span class="selector-class">.col-lg-3</span>,</div><div class="line"><span class="selector-class">.col-xs-4</span>,<span class="selector-class">.col-sm-4</span>,<span class="selector-class">.col-md-4</span>,<span class="selector-class">.col-lg-4</span>,</div><div class="line"><span class="selector-class">.col-xs-5</span>,<span class="selector-class">.col-sm-5</span>,<span class="selector-class">.col-md-5</span>,<span class="selector-class">.col-lg-5</span>,</div><div class="line"><span class="selector-class">.col-xs-6</span>,<span class="selector-class">.col-sm-6</span>,<span class="selector-class">.col-md-6</span>,<span class="selector-class">.col-lg-6</span>,</div><div class="line"><span class="selector-class">.col-xs-7</span>,<span class="selector-class">.col-sm-7</span>,<span class="selector-class">.col-md-7</span>,<span class="selector-class">.col-lg-7</span>,</div><div class="line"><span class="selector-class">.col-xs-8</span>,<span class="selector-class">.col-sm-8</span>,<span class="selector-class">.col-md-8</span>,<span class="selector-class">.col-lg-8</span>,</div><div class="line"><span class="selector-class">.col-xs-9</span>,<span class="selector-class">.col-sm-9</span>,<span class="selector-class">.col-md-9</span>,<span class="selector-class">.col-lg-9</span>,</div><div class="line"><span class="selector-class">.col-xs-10</span>,<span class="selector-class">.col-sm-10</span>,<span class="selector-class">.col-md-10</span>,<span class="selector-class">.col-lg-10</span>,</div><div class="line"><span class="selector-class">.col-xs-11</span>,<span class="selector-class">.col-sm-11</span>,<span class="selector-class">.col-md-11</span>,<span class="selector-class">.col-lg-11</span>,</div><div class="line"><span class="selector-class">.col-xs-12</span>,<span class="selector-class">.col-sm-12</span>,<span class="selector-class">.col-md-12</span>,<span class="selector-class">.col-lg-12</span> </div><div class="line">&#123;</div><div class="line">  <span class="attribute">position</span>: relative;</div><div class="line">  <span class="attribute">min-height</span>: <span class="number">1px</span>;</div><div class="line">  <span class="attribute">padding-right</span>: <span class="number">15px</span>;</div><div class="line">  <span class="attribute">padding-left</span>: <span class="number">15px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>提取出公共属性后，我们需要将其分配到不同分辨率，是怎么做的呢，这里十分巧妙：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">%grid-column &#123;</div><div class="line">   <span class="attribute">position</span>: relative;</div><div class="line">   <span class="comment">// Prevent columns from collapsing when empty</span></div><div class="line">   <span class="attribute">min-height</span>: <span class="number">1px</span>;</div><div class="line">   <span class="comment">// Inner gutter via padding</span></div><div class="line">   <span class="attribute">padding-left</span>: (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line">   <span class="attribute">padding-right</span>: (<span class="variable">$gutter</span> / <span class="number">2</span>);</div><div class="line"> &#125;</div><div class="line"> @<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$breakpoints</span>) &#123;</div><div class="line">   @<span class="keyword">for</span> <span class="variable">$i</span> from 1 through <span class="variable">$columns</span> &#123;</div><div class="line">     <span class="selector-class">.col-</span>#&#123;<span class="variable">$breakpoint</span>&#125;-#&#123;<span class="variable">$i</span>&#125; &#123;</div><div class="line">       @<span class="keyword">extend</span> %grid-column;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line">   @<span class="keyword">include</span> media-breakpoint-up(<span class="variable">$breakpoint</span>) &#123;</div><div class="line">     <span class="comment">// Work around cross-media @extend (https://github.com/sass/sass/issues/1050)</span></div><div class="line">     %grid-column-<span class="attribute">float</span>-#&#123;<span class="variable">$breakpoint</span>&#125; &#123;</div><div class="line">       @<span class="keyword">if</span> <span class="variable">$enable-flex</span> &#123;</div><div class="line">         <span class="comment">// Do nothing</span></div><div class="line">       &#125; @<span class="keyword">else</span> &#123;</div><div class="line">         <span class="attribute">float</span>: left;</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">     @<span class="keyword">for</span> <span class="variable">$i</span> from 1 through <span class="variable">$columns</span> &#123;</div><div class="line">       <span class="selector-class">.col-</span>#&#123;<span class="variable">$breakpoint</span>&#125;-#&#123;<span class="variable">$i</span>&#125; &#123;</div><div class="line">         @<span class="keyword">extend</span> %grid-column-float-#&#123;<span class="variable">$breakpoint</span>&#125;;</div><div class="line">         @<span class="keyword">include</span> make-col-span(<span class="variable">$i</span>, <span class="variable">$columns</span>);</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>可以看出，它是在遍历分辨率尺寸的基础上，使用定义好的<code>media-breakpoint-up</code>的mixin再进行迭代，这里值得注意的一点是，由于之前我们已经生成了<code>.col-#{$breakpoint}-#{$i}</code>的基本属性，所以在进行查询媒体迭代时，<code>@extend %grid-colum-float-#{$breakpoint}</code>会附加在原有的基本属性上。这样就把各种类名分配到了相应的媒体查询上。<br>当然除此之外，还有push、pull、offset之类的其实也差不多，这里就不再重复了。除此之外有一点人们容易忽略的地方是，Grid系统是基于border-box，这点是实现Grid魔法的关键之一：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span> &#123;</div><div class="line">  <span class="attribute">box-sizing</span>: border-box;</div><div class="line">&#125;</div><div class="line"></div><div class="line">*,</div><div class="line">*<span class="selector-pseudo">:before</span>,</div><div class="line">*<span class="selector-pseudo">:after</span> &#123;</div><div class="line">  <span class="attribute">box-sizing</span>: inherit;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="三、normalize-css"><a href="#三、normalize-css" class="headerlink" title="三、normalize.css"></a>三、normalize.css</h3><p>&ensp;&ensp;&ensp;&ensp;Bootstrap中使用<a href="https://github.com/necolas/normalize.css" target="_blank" rel="external">normalize.css</a>来初始化样式。之前我一直使用<a href="http://meyerweb.com/eric/tools/css/reset/" target="_blank" rel="external">reset.css</a>来重置浏览器的默认样式，而normalize.css是reset.css的一种替代方案。之所称其为替代方案，作者<a href="https://github.com/necolas" target="_blank" rel="external">necolas</a>介绍时已经把其说的很清楚了：  </p>
<blockquote>
<ul>
<li>保护有用的浏览器默认样式而不是完全去掉它们</li>
<li>一般化的样式：为大部分HTML元素提供</li>
<li>修复浏览器自身的bug并保证各浏览器的一致性</li>
<li>优化CSS可用性：用一些小技巧</li>
<li>解释代码：用注释和详细的文档来</li>
</ul>
</blockquote>
<p>简单点说，它和reset.css不同之处在于：     </p>
<ul>
<li>Reset是相对‘暴力’的，不管你有用没用，都重置成统一的样式，所有东西都必须一致。  </li>
<li>normalize.css却是相对‘平和’的，不求样式一致,尽量保留浏览器的默认样式，尽量不进行太多的重置。  </li>
</ul>
<p>举个简单的栗子，对于简单的一个 <strong>h1</strong> 标签来说，reset.css可能会做很多事：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//reset.css</span></div><div class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-tag">div</span>, <span class="selector-tag">span</span>, applet, <span class="selector-tag">object</span>, <span class="selector-tag">iframe</span>,</div><div class="line"> <span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>, <span class="selector-tag">p</span>, <span class="selector-tag">blockquote</span>, <span class="selector-tag">pre</span>,</div><div class="line"> <span class="selector-tag">a</span>, <span class="selector-tag">abbr</span>, <span class="selector-tag">acronym</span>, <span class="selector-tag">address</span>, <span class="selector-tag">big</span>, <span class="selector-tag">cite</span>, <span class="selector-tag">code</span>,</div><div class="line"> <span class="selector-tag">del</span>, <span class="selector-tag">dfn</span>, <span class="selector-tag">em</span>, <span class="selector-tag">img</span>, <span class="selector-tag">ins</span>, <span class="selector-tag">kbd</span>, <span class="selector-tag">q</span>, s, <span class="selector-tag">samp</span>,</div><div class="line"> <span class="selector-tag">small</span>, <span class="selector-tag">strike</span>, <span class="selector-tag">strong</span>, <span class="selector-tag">sub</span>, <span class="selector-tag">sup</span>, <span class="selector-tag">tt</span>, <span class="selector-tag">var</span>,</div><div class="line"> <span class="selector-tag">b</span>, u, <span class="selector-tag">i</span>, center,</div><div class="line"> <span class="selector-tag">dl</span>, <span class="selector-tag">dt</span>, <span class="selector-tag">dd</span>, <span class="selector-tag">ol</span>, <span class="selector-tag">ul</span>, <span class="selector-tag">li</span>,</div><div class="line"> <span class="selector-tag">fieldset</span>, <span class="selector-tag">form</span>, <span class="selector-tag">label</span>, <span class="selector-tag">legend</span>,</div><div class="line"> <span class="selector-tag">table</span>, <span class="selector-tag">caption</span>, <span class="selector-tag">tbody</span>, <span class="selector-tag">tfoot</span>, <span class="selector-tag">thead</span>, <span class="selector-tag">tr</span>, <span class="selector-tag">th</span>, <span class="selector-tag">td</span>,</div><div class="line"> <span class="selector-tag">article</span>, <span class="selector-tag">aside</span>, <span class="selector-tag">canvas</span>, <span class="selector-tag">details</span>, <span class="selector-tag">embed</span>, </div><div class="line"> <span class="selector-tag">figure</span>, <span class="selector-tag">figcaption</span>, <span class="selector-tag">footer</span>, <span class="selector-tag">header</span>, <span class="selector-tag">hgroup</span>, </div><div class="line"> menu, <span class="selector-tag">nav</span>, <span class="selector-tag">output</span>, <span class="selector-tag">ruby</span>, <span class="selector-tag">section</span>, summary,</div><div class="line"> <span class="selector-tag">time</span>, <span class="selector-tag">mark</span>, <span class="selector-tag">audio</span>, <span class="selector-tag">video</span> &#123;</div><div class="line"> 	<span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line"> 	<span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line"> 	<span class="attribute">border</span>: <span class="number">0</span>;</div><div class="line"> 	<span class="attribute">font-size</span>: <span class="number">100%</span>;</div><div class="line"> 	<span class="attribute">font</span>: inherit;</div><div class="line"> 	<span class="attribute">vertical-align</span>: baseline;</div><div class="line"> &#125;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>而nomalize.css只是这样做：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Address variable `h1` font-size and margin within `section` and `article`</span></div><div class="line"><span class="comment">// contexts in Firefox 4+, Safari, and Chrome.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="selector-tag">h1</span> &#123;</div><div class="line">  <span class="attribute">font-size</span>: <span class="number">2em</span>;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">0.67em</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你可以很轻易的看出其中思想上的差别，也就是说，normalize.css的优势在于它保持了许多浏览器的默认样式，当一个元素在不同浏览器中有不同的默认值时，nomalize.css会让样式保持一致并且尽可能的与现代标准相符合；以及修复了常用的桌面端和移动端浏览器的bug，比如HTML5元素的显示设置、预格式化文字的font-size问题、在IE9中SVG的溢出、许多出现在各浏览器和操作系统中的与表单相关的bug。  </p>
<p>对于使用reset.css还是normalize.css，仁者见仁智者见智吧。  </p>
<h3 id="写在后面"><a href="#写在后面" class="headerlink" title="写在后面"></a>写在后面</h3><p>Bootstrap在设计上是非常注重模块化以及层次化的，一方面是利于维护，另一方面提高了可复用性，这点非常值得学习。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://getbootstrap.com/2.3.2/&quot; target=&quot;_blank&quot; rel=&quot;
    
    </summary>
    
    
      <category term="css" scheme="http://yoursite.com/tags/css/"/>
    
  </entry>
  
</feed>
