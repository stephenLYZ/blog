<!DOCTYPE html>
<html lang=en>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="null">
  <meta name="keywords" content="undefined">
  
    <link rel="icon" href="">
  
  <title>手把手实现一个 Color-Picker</title>
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/atom-one-light.css">
<link rel="stylesheet" href="/css/font-awesome.min.css">
  <script src="/js/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
  <div class="wrapper">
    <div class="default_title">
        <img src="/imgs/mycomputer.png" />
        <h1>stephen&#39;s blog</h1>
    </div>
    <ul class="topbar">
    
        <li>
        <a href="/" class="item-link">首页</a>
        </li>
    
        <li>
        <a href="/about" class="item-link">关于</a>
        </li>
    
    </ul>
    <div class="tag_list">
    <ul id="tag-list">
        <li><a href="/" ><img src="/imgs/disk.png" />(C:)</a>
        <ul>
        
            <li>
            <a href="/tags/js" title="js" rel="6">
                <img src="/imgs/folder.ico" />
                js
            </a>
            </li>    
        
            <li>
            <a href="/tags/nodeJs" title="nodeJs" rel="2">
                <img src="/imgs/folder.ico" />
                nodeJs
            </a>
            </li>    
        
            <li>
            <a href="/tags/源码分析" title="源码分析" rel="2">
                <img src="/imgs/folder.ico" />
                源码分析
            </a>
            </li>    
        
            <li>
            <a href="/tags/algorithm" title="algorithm" rel="1">
                <img src="/imgs/folder.ico" />
                algorithm
            </a>
            </li>    
        
            <li>
            <a href="/tags/translate" title="translate" rel="2">
                <img src="/imgs/folder.ico" />
                translate
            </a>
            </li>    
        
        </ul>
    </ul>
    </div>
    <div class="post_list">
    <ul>
        
            <li>
            <a href="/2017/09/13/A-color-picker-from-the-scratch/">
            <img src="/imgs/file.ico" />
                手把手实现一个 Color-Picker
            </a>
            </li>
        
            <li>
            <a href="/2017/06/13/Hack！如何让Github-Pages支持browser-history/">
            <img src="/imgs/file.ico" />
                Hack！如何让Github Pages支持browser history
            </a>
            </li>
        
            <li>
            <a href="/2017/06/03/2016-NingJS-JSConf-CN-2016-见闻/">
            <img src="/imgs/file.ico" />
                2016 NingJS(JSConf CN 2016) 见闻
            </a>
            </li>
        
            <li>
            <a href="/2017/06/17/Rethinking Asynchronous Programming in Javascript/">
            <img src="/imgs/file.ico" />
                Rethinking Asynchronous Programming in Javascript
            </a>
            </li>
        
            <li>
            <a href="/2017/06/11/Understanding-Event-Loop-in-Javascript/">
            <img src="/imgs/file.ico" />
                Understanding Event Loop in Javascript
            </a>
            </li>
        
            <li>
            <a href="/2017/06/10/Web-Real-time-Connection/">
            <img src="/imgs/file.ico" />
                Web Real-time Connection
            </a>
            </li>
        
            <li>
            <a href="/2017/06/09/bootstrap之CSS源码分析/">
            <img src="/imgs/file.ico" />
                bootstrap之CSS源码分析
            </a>
            </li>
        
            <li>
            <a href="/2017/07/15/从jquery源码看无new构造/">
            <img src="/imgs/file.ico" />
                从jquery源码看无new构造
            </a>
            </li>
        
            <li>
            <a href="/2017/06/13/最小编辑距离问题（Edit-Distance/">
            <img src="/imgs/file.ico" />
                最小编辑距离问题(Edit Distance)
            </a>
            </li>
        
            <li>
            <a href="/2017/06/13/深入浅出throttle和debounce/">
            <img src="/imgs/file.ico" />
                深入浅出throttle和debounce
            </a>
            </li>
        
            <li>
            <a href="/2017/06/13/［译］什么时候“不要”用箭头函数/">
            <img src="/imgs/file.ico" />
                ［译］什么时候“不要”用箭头函数
            </a>
            </li>
        
            <li>
            <a href="/2017/06/07/［译］关于vertical-align你应该知道的事/">
            <img src="/imgs/file.ico" />
                ［译］关于vertical-align你应该知道的事
            </a>
            </li>
        
            <li>
            <a href="/2017/07/31/LazyMan的几种解法/">
            <img src="/imgs/file.ico" />
                LazyMan的几种解法
            </a>
            </li>
        
            <li>
            <a href="/2017/06/08/Module-exports-vs-Exports-in-Node-js/">
            <img src="/imgs/file.ico" />
                Module.exports vs Exports in Node.js
            </a>
            </li>
        
    </ul>
    </div>

    <div class="post_total">
        
            <div class="left">[object Object] object(s)</div>
        
        <div class="right">&nbsp;</div>
    </div>
</div>
  <div class="content">
    <div class="post_title">
      <img src="/imgs/file.png" />
      <h1>手把手实现一个 Color-Picker</h1>
      <a href="/"><div class="btn"><span class="fa fa-times"></span></div></a>
      <div class="btn btn_max"><span class="fa fa-window-maximize"></span></div>
      <div class="btn"><span class="fa fa-window-minimize"></span></div>
    </div>
    <ul class="topbar">
      <li>Wed Sep 13 2017 16:01:35 GMT+0800</li>
    </ul>
    <div class="post_content">
      <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Color-Picker 组件在富文本编辑器、画图类等应用中十分常见，通过获取当前选中颜色的值来更新其他视图，本文基于 ES6 的语法手把手实现一个 Color-Picker 组件，demo 可以点击<a href="stephenliu.site/Doooosth/ColorPicker/">这里</a>。在实现之前，先简单的分析一下组件整个的结构，Color-Picker 主要由三部分构成：color-label、color-options、color-field<br><img src="/media/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-09-20%2016.06.50.png" alt="屏幕快照 2017-09-20 16.06.50"></p>
<ul>
<li>color-label: 点击展开颜色面板，当选中某颜色值时，背景颜色需要同时更新</li>
<li>color-options: 颜色面板，由一个个 color-item 组成</li>
<li>color-field: 颜色十六进制展示面板</li>
</ul>
<p>下面我们就一步步实现这样的一个组件。</p>
<h2 id="组件实现"><a href="#组件实现" class="headerlink" title="组件实现"></a>组件实现</h2><p>首先我们先定义一个 ColorPicker 的类以及基本的一些方法:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColorPicker</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(options)&#123;</div><div class="line">    <span class="keyword">this</span>.options = <span class="built_in">Object</span>.assign(&#123;&#125;, ColorPicker.DEFAULT, options)</div><div class="line">    <span class="keyword">this</span>.el = <span class="built_in">document</span>.querySelector(<span class="keyword">this</span>.options.el)</div><div class="line">    <span class="keyword">this</span>.colors = <span class="keyword">this</span>.options.colors || []</div><div class="line">    <span class="keyword">this</span>.handler = <span class="keyword">this</span>.options.handler || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">    <span class="keyword">this</span>.selectedColor = <span class="keyword">this</span>.options.default</div><div class="line">    <span class="keyword">this</span>.container = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>)</div><div class="line">    <span class="keyword">this</span>.el.appendChild(<span class="keyword">this</span>.container)</div><div class="line">    <span class="keyword">this</span>.buildPicker()</div><div class="line">    <span class="keyword">this</span>.label.addEventListener(<span class="string">'mousedown'</span>, () =&gt; &#123;</div><div class="line">        <span class="keyword">this</span>.container.classList.toggle(<span class="string">'expanded'</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  buildLabel() &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  buildItem() &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  buildOptions() &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  buildField() &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  buildPicker() &#123;</div><div class="line">    <span class="keyword">this</span>.container.classList.add(<span class="string">'picker'</span>)</div><div class="line">    <span class="keyword">this</span>.label = <span class="keyword">this</span>.buildLabel()</div><div class="line">    <span class="keyword">this</span>.options = <span class="keyword">this</span>.buildOptions()</div><div class="line">    <span class="keyword">this</span>.field = <span class="keyword">this</span>.buildField()    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>构造函数里初始化一些传入的参数，这里我们默认的 options 组成是这样的:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">ColorPicker.DEFAULT = &#123;</div><div class="line">    <span class="attr">el</span>: <span class="string">'#container'</span>,</div><div class="line">    <span class="attr">default</span>: <span class="string">"#000000"</span>,</div><div class="line">    <span class="attr">colors</span>: [</div><div class="line">        <span class="string">"#000000"</span>, <span class="string">"#e60000"</span>, <span class="string">"#ff9900"</span>, <span class="string">"#ffff00"</span>, <span class="string">"#008a00"</span>, <span class="string">"#0066cc"</span>, <span class="string">"#9933ff"</span>,</div><div class="line">        <span class="string">"#ffffff"</span>, <span class="string">"#facccc"</span>, <span class="string">"#ffebcc"</span>, <span class="string">"#ffffcc"</span>, <span class="string">"#cce8cc"</span>, <span class="string">"#cce0f5"</span>, <span class="string">"#ebd6ff"</span>,</div><div class="line">        <span class="string">"#bbbbbb"</span>, <span class="string">"#f06666"</span>, <span class="string">"#ffc266"</span>, <span class="string">"#ffff66"</span>, <span class="string">"#66b966"</span>, <span class="string">"#66a3e0"</span>, <span class="string">"#c285ff"</span>,</div><div class="line">        <span class="string">"#888888"</span>, <span class="string">"#a10000"</span>, <span class="string">"#b26b00"</span>, <span class="string">"#b2b200"</span>, <span class="string">"#006100"</span>, <span class="string">"#0047b2"</span>, <span class="string">"#6b24b2"</span>,</div><div class="line">        <span class="string">"#444444"</span>, <span class="string">"#5c0000"</span>, <span class="string">"#663d00"</span>, <span class="string">"#666600"</span>, <span class="string">"#003700"</span>, <span class="string">"#002966"</span>, <span class="string">"#3d1466"</span></div><div class="line">    ],</div><div class="line">    <span class="attr">handler</span>: <span class="function"><span class="keyword">function</span>(<span class="params">color</span>) </span>&#123;</div><div class="line">        <span class="keyword">let</span> display = <span class="built_in">document</span>.querySelector(<span class="string">'.display'</span>)</div><div class="line">        display.innerHTML = color</div><div class="line">        display.style.color = color</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中 el 是绑定的元素， default 是默认的颜色，colors 是色板数组， handler 是选中颜色时执行的回调。可以看到，我们在构造函数里创建了一个 container 将其与 el 绑定起来，同时监听 label 的 mousedown 事件来控制展开颜色面板，下面我们分别实现组件元素的 build。</p>
<p>构建 color-label:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> buildLabel() &#123;</div><div class="line">    <span class="keyword">let</span> label = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>)</div><div class="line">    label.classList.add(<span class="string">'picker-label'</span>)</div><div class="line">    label.style.backgroundColor = <span class="keyword">this</span>.options.default</div><div class="line">    <span class="keyword">this</span>.container.appendChild(label)</div><div class="line">    <span class="keyword">return</span> label</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>构建 color-item:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">buildItem(option) &#123;</div><div class="line">    <span class="keyword">let</span> item = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>)</div><div class="line">    item.classList.add(<span class="string">'picker-item'</span>)</div><div class="line">    item.setAttribute(<span class="string">'data-value'</span>, option)</div><div class="line">    item.style.backgroundColor = option</div><div class="line">    item.addEventListener(<span class="string">'click'</span>, () =&gt; <span class="keyword">this</span>.selectItem(item, <span class="literal">true</span>))</div><div class="line">    <span class="keyword">return</span> item</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里给每个 item 加上一个 data-value 的属性，方便我们拿到当前选中的颜色值，同时监听每个 item 的 click，然后执行 selectItem 更新其他部分（下面会说到）。</p>
<p>构建 color-options:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">buildOptions() &#123;</div><div class="line">    <span class="keyword">let</span> options = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>)</div><div class="line">    options.classList.add(<span class="string">'picker-options'</span>)</div><div class="line">    <span class="keyword">this</span>.colors.forEach(<span class="function">(<span class="params">option</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> item = <span class="keyword">this</span>.buildItem(option)</div><div class="line">        options.appendChild(item)</div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">this</span>.container.append(options)</div><div class="line">    <span class="keyword">return</span> options</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>构建 color-field:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">buildField() &#123;</div><div class="line">    <span class="keyword">let</span> field = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>)</div><div class="line">    field.classList.add(<span class="string">'picker-field'</span>)</div><div class="line">    field.innerHTML = <span class="keyword">this</span>.selectedColor</div><div class="line">    <span class="keyword">this</span>.options.appendChild(field)</div><div class="line">    <span class="keyword">return</span> field</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>组成元素构建完成后就只剩下，每次点击元素后更新对应元素的状态，同时执行传入的回调，我们通过 selectItem 实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">selectItem(item, triggle = <span class="literal">false</span>) &#123;</div><div class="line">    <span class="keyword">let</span> selected = <span class="keyword">this</span>.container.querySelector(<span class="string">'.selected'</span>)</div><div class="line">    <span class="keyword">if</span> (item === selected) <span class="keyword">return</span></div><div class="line">    <span class="keyword">if</span> (selected != <span class="literal">null</span>) selected.classList.remove(<span class="string">'selected'</span>)</div><div class="line">    <span class="keyword">if</span> (item == <span class="literal">null</span>) <span class="keyword">return</span></div><div class="line">    item.classList.add(<span class="string">'selected'</span>)</div><div class="line">    <span class="keyword">if</span> (item.hasAttribute(<span class="string">'data-value'</span>)) &#123;</div><div class="line">        <span class="keyword">this</span>.selectedColor = item.getAttribute(<span class="string">'data-value'</span>)</div><div class="line">        <span class="keyword">this</span>.label.style.backgroundColor = <span class="keyword">this</span>.selectedColor</div><div class="line">        <span class="keyword">this</span>.field.innerHTML = <span class="keyword">this</span>.selectedColor</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (triggle) &#123;</div><div class="line">        value &amp;&amp; <span class="keyword">this</span>.handler(value)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到，这里我们通过拿到选中 item 的 data-value 的值来分别更新 color-label、color-field 的值，同时执行相应的回调。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此一个简单的 Color-Picker 组件就完成了，实现也很简单，具体源码放在我的 <a href="https://github.com/stephenLYao/Doooosth/blob/gh-pages/ColorPicker/index.html" target="_blank" rel="external">github</a>。</p>

    </div>
</div>
  <footer class="footer">
  <p> powered by hexo</p>
</footer>
<script>
  var max = document.getElementsByClassName("btn")[1];
  var min = document.getElementsByClassName("btn")[2];

  function maximize () {
    var post = document.getElementsByClassName("content")[0];
    var cont = document.getElementsByClassName("post_content")[0];
    var wid = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName("body")[0].clientWidth;

    if (wid > 900) {
      widf = wid * 0.9;
      post.style.width = widf + "px";

      if (wid < 1400) {
        cont.style.width = "99%";
      } else {
        cont.style.width = "99.4%";
      }
    }
  }

  function minimize () {
    var post = document.getElementsByClassName("content")[0];
    var cont = document.getElementsByClassName("post_content")[0];
    var wid = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName("body")[0].clientWidth;

    if ( wid > 900 ) {
      post.style.width = "800px";
      cont.style.width = "98.5%";
    }
  }

  max && max.addEventListener('click', maximize, false);
  min && min.addEventListener('click', minimize, false);

</script>
</body>
</html>