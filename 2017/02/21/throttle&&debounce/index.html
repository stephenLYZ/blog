<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  

  <!--Author-->
  
  <meta name="author" content="Stephen Liu">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="深入浅出throttle和debounce"/>
  
  <!--Open Graph Description-->
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Stephen&#39;blog"/>
  <!--Type page-->
  
      <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title -->
  
  <title>深入浅出throttle和debounce - Stephen&#39;blog</title>


  <link rel="shortcut icon" href="https://hexo.io/icon/favicon-96x96.png">

  <!-- Custom CSS/Sass -->
  <!-- <link rel="stylesheet" href="/css/style.css"> -->
  <link rel="stylesheet" type="text/css" href="/css/style.css">

  <!----------------------------
  https://github.com/GallenHu/hexo-theme-Daily

 _____            _   _
|  __ \          (_) | |
| |  | |   __ _   _  | |  _   _
| |  | |  / _` | | | | | | | | |
| |__| | | (_| | | | | | | |_| |
|_____/   \__,_| |_| |_|  \__, |
                          __/ |
                         |___/

    --------------------------->

</head>


<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="http://7xl0rs.com1.z0.glb.clouddn.com/avatar.png" alt="Stephen'blog" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  home
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  archive
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            深入浅出throttle和debounce
            
          </h1>
          <p class="posted-on">
          2017-02-21
          </p>
          <div class="tags-links">
            
              
                <a href="/tags/javascript/" rel="tag">
                  javascript
                </a>
              
            
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前我在写一个获取github用户信息的小应用的时候，遇到了一个问题： 由于我在input上绑定了keyup的监听事件（也就是ajax请求），每按下一次键盘键就会发出一次ajax请求，显然频繁的网络的请求会造成很大的性能问题。这里的解决办法就是用函数去抖(debounce)。那么什么是函数去抖？他的基友函数节流(throttle)又是什么？他们有什么区别？他们应用的场景有分别是什么？下面一一来解答。  </p>
<h2 id="函数去抖"><a href="#函数去抖" class="headerlink" title="函数去抖"></a>函数去抖</h2><p>简单来说，函数去抖背后的思想指的是 <strong>某函数只有在过完一段时间后并且该段时间内不被调用才会被执行</strong>。一旦在指定的时间间隔内调用该函数，该函数就不会被执行。那上面例子来说，在没有去抖之前:   </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">content</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'ajax request '</span> + content)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'search'</span>)</div><div class="line">input.addEventListener(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  ajax(e.target.value)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><img width="479" alt="qq20170221-151811 2x" src="https://cloud.githubusercontent.com/assets/11830681/23156778/4974f46e-f853-11e6-8394-7eb41b62ca3a.png"></p>
<p>可以看到，每按下一次键盘键就会发送一次ajax请求。现在用<code>debounce()</code>方法来改进： </p>
<p><a href="https://jsbin.com/wajexuboya/edit?js,console,output" target="_blank" rel="external">jsbin</a> </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">func, delay</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span></div><div class="line">    <span class="keyword">var</span> _args = args</div><div class="line">    clearTimeout(func.id)</div><div class="line">    func.id = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      func.call(_this, _args)</div><div class="line">    &#125;, delay)</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'ajax request '</span> + value)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> debounceAjax = debounce(ajax, <span class="number">1000</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'search'</span>)</div><div class="line">input.addEventListener(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  debounceAjax(e.target.value)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><img src="https://cloud.githubusercontent.com/assets/11830681/23156749/2c8f6e7e-f853-11e6-8d8b-0b5b22d05258.gif" alt="throttle1"></p>
<p>可以看到当你输入的时候，并不会发送ajax请求，当停止输入并且在指定间隔内没有输入时候，才会执行相应的回调函数。下面我们来讲讲他的好基友，函数节流(throttle)。  </p>
<h2 id="函数节流"><a href="#函数节流" class="headerlink" title="函数节流"></a>函数节流</h2><p>函数节流指的是 <strong>某函数在指定的一个时间段周期性的间断执行</strong>。 什么意思呢，举上面的例子，当在input中不断键入数值的时候，debounce是在你停止输入一段时间后执行回调函数，而throttle则是在你输入过程中每隔一段固定的时间就执行回调函数。<br><a href="https://jsbin.com/nifeyicava/edit?js,console,output" target="_blank" rel="external">代码</a>    </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">func, delay</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> last, deferTimer</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span></div><div class="line">    <span class="keyword">var</span> _args = <span class="built_in">arguments</span></div><div class="line">    <span class="keyword">var</span> now = +<span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">    <span class="keyword">if</span>(last &amp;&amp; now &lt; last + delay) &#123;</div><div class="line">      clearTimeout(deferTimer)</div><div class="line">      deferTimer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        last = now</div><div class="line">        func.apply(_this, _args)</div><div class="line">      &#125;, delay)</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">      last = now</div><div class="line">      func.apply(_this, _args)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'ajax request '</span> + value)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> throttleAjax = throttle(ajax, <span class="number">1000</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'search'</span>)</div><div class="line">input.addEventListener(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  throttleAjax(e.target.value)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><img src="https://cloud.githubusercontent.com/assets/11830681/23156788/53ac021a-f853-11e6-98e9-4c81a0c2a797.gif" alt="throttle2"><br>可以看出，当我在input中不断键入值时，ajax回调函数每过1s执行一次。  </p>
<h2 id="异同"><a href="#异同" class="headerlink" title="异同"></a>异同</h2><p>从上面的内容可以知道，函数去抖和函数分流都是解决某一事件频繁触发的问题，比如input的ajax请求、scroll事件等等。即使如此，他们的实现原理却大相庭径，简单来说，函数去抖在一段时间只执行一次，而函数节流则是间隔时间段执行。比如，一个举个例子，小明吃饼干，有两种吃法，第一种是每过一段时间间隔吃一块饼干，这是函数节流，第二种是第一块饼干吃完后得过一段时间才能吃第二块饼干，期间不能吃饼干，这是函数去抖。  </p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>发送一个ajax表单，给一个button绑定click事件，并且监听触发ajax请求。如果是debounce，则用户不管点多少次，都只会发送一次请求；如果是throttle，不断点击的过程中会间隔发送请求。这时候最好使用debounce.</li>
<li>监听滚动事件判断是否到页面底部自动加载更多，如果是debounce，则只有在用户停止滚动的时候的才会判断是否到了底部，如果是throttle，则页面滚动的过程中会间隔判断是否到达底部。  此时最好使用throttle</li>
</ul>
<p><strong>其他</strong> </p>
<ul>
<li>DOM 元素的拖拽功能实现（mousemove）</li>
<li>射击游戏的 mousedown/keydown 事件（单位时间只能发射一颗子弹）</li>
<li>计算鼠标移动的距离（mousemove）</li>
<li>Canvas 模拟画板功能（mousemove）</li>
<li>搜索联想（keyup）</li>
</ul>
<p><strong>参考:</strong> <a href="https://github.com/hanzichi/underscore-analysis/issues/20" target="_blank" rel="external">https://github.com/hanzichi/underscore-analysis/issues/20</a></p>

        </div>
      </article>
    </div>
    <!-- Comments -->
    <div class="container">
      
    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
      
        <div class="nav-next">
          <a href="/2016/12/10/web-performance/" rel="prev">下一页 <span class="meta-arraw meta-arraw-right"></span></a>
        </div>
      
    </div>

  </div>
</div>


  <!-- Footer -->
  <!-- Footer-widgets -->
<div class="footer-widgets">
  <div class="row inside-wrapper">
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">null</h1>
        <div class="custom-widget-content">
          
          
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">与我联系</h1>
        <div class="widget-text">
          
            
              <a href="https://github.com/stephenLYao" class="icon icon-github" target="_blank">github</a>
            
          
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">站内搜索</h1>
        <div class="widget-text">
          <form onSubmit="return appDaily.submitSearch('')">
            <p>
              <input type="text" placeholder="search..." id="homeSearchInput">
            </p>
            <!-- <input type="submit" value="GO"> -->
          </form>
        </div>
      </aside>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="site-info">
  <p>
    <span>Stephen'blog &copy; 2017</span>
    
      <span class="split">|</span><span>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> with Theme <a href="https://github.com/GallenHu/hexo-theme-Daily" target="_blank">Daily</a></span>
    
  </p>
</footer>


  <!-- After footer scripts -->
  <!-- scripts -->
<script src="//cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
<script src="/js/app.js"></script>



</body>

</html>